{% extends 'base-fa6.html' %}
{% load asset_tags humanize numbers qurl static %}
{% block title %}User Detail | {{ employee.id }}{% endblock %}
{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/select2.css' %}" />
{% endblock %}
{% block content %}
<div class="uk-section uk-section-muted uk-padding uk-padding-remove-top">
    <div class="uk-grid-small uk-child-width-1-1" data-uk-grid>
        <!-- EMPLOYEE SEARCH -->
        <div>
            <div class="uk-card uk-card-default uk-card-small">
                <div class="uk-card-body">
                    <form class="uk-grid-collapse uk-flex uk-flex-center" action="{% url 'users:home_employee' %}" method="POST" data-uk-grid>
                        {% csrf_token %}
                        <div class="uk-button-group uk-width-1-1">
                            <input class="uk-input uk-form-small uk-width-1-1" type="search" name="search" value="{{ request.GET.search }}" placeholder="Search by employee FLEID, name, or username" style="border-right:0">
                            <button class="uk-button uk-button-primary uk-button-small">Search</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <!-- /SEARCH -->
        <!-- EMPLOYEE HEADER -->
        <div>
            <div class="uk-grid-small uk-child-width-1-1" data-uk-grid>
                <div class="uk-card uk-card-small uk-margin-small">
                    <div class="uk-card-body uk-background-muted" data-uk-sticky="offset:80" style="z-index:900">
                        <div id="user-header" class="uk-grid-small uk-flex uk-flex-middle" data-uk-grid>
                            <div class="uk-width-auto">
                                <i class="fas fa-user fa-3x"></i>
                            </div>
                            <div class="uk-width-expand">
                                <div class="uk-card-title">
                                    <span class="clipboard" data-uk-tooltip="Click2Copy" data-clipboard-action="copy" data-clipboard-text="{{ employee.name }}">{{ employee.name }}</span>
                                    {% if is_admin %}
                                    <a class="uk-badge uk-badge-success uk-padding-small uk-padding-remove-vertical uk-link-reset" data-uk-tooltip="{{ employee.get_role }}">
                                        {% if employee.get_role_id == 'OTO' %}1:1{% else %}{{ employee.get_role_id }}{% endif %}<i class="fas fa-caret-down" style="margin-left: 5px"></i>
                                    </a>
                                    <div data-uk-dropdown="mode: click; pos: bottom-justify; offset: 5; animation: uk-animation-slide-top-small; duration: 200">
                                        <ul class="uk-dropdown-nav" data-uk-nav>
                                            <li class="uk-nav-header" style="padding-top: 0">Change EC</li>
                                            <li class="uk-nav-divider"></li>
                                            {% for role in roles %}
                                            {% if role.id != employee.role.id %}
                                            <li><a id="change-ec" data-id="{{ role.id }}" style="padding: 1px{% if forloop.last %}; padding-bottom: 5px{% endif %}">{{ role.name }}</a></li>
                                            {% endif %}
                                            {% endfor %}
                                        </ul>
                                    </div>
                                    {% else %}
                                    <span class="uk-badge uk-badge-success uk-padding-small uk-padding-remove-vertical" data-uk-tooltip="{{ employee.get_role }}">
                                        {% if employee.get_role_id == 'OTO' %}1:1{% else %}{{ employee.get_role_id }}{% endif %}
                                    </span>
                                    {% endif %}
                                    {% if is_super_admin %}
                                    <a class="uk-badge{% if employee.status.id == 'IT' %} uk-badge-warning{% else %} uk-badge-white{% endif %} uk-padding-small uk-padding-remove-vertical" data-uk-tooltip="{{ employee.status }}">
                                        {{ employee.status.id }}<i class="fas fa-caret-down" style="margin-left:5px"></i>
                                    </a>
                                    <div data-uk-dropdown="mode: click; pos: bottom-justify; offset: 5; animation: uk-animation-slide-top-small; duration: 200">
                                        <ul class="uk-dropdown-nav" data-uk-nav>
                                            <li class="uk-nav-header" style="padding-top: 0">Change Status</li>
                                            <li class="uk-nav-divider"></li>
                                            {% for status in statuses %}
                                            {% if status.id != employee.status.id %}
                                            <li>
                                                <a id="change-status" data-id="{{ status.id }}" style="padding: 1px{% if forloop.last %}; padding-bottom: 5px{% endif %}">{{ status.name }}</a>
                                            </li>
                                            {% endif %}
                                            {% endfor %}
                                        </ul>
                                    </div>
                                    {% else %}
                                    <span class="uk-badge{% if employee.status.id == 'IT' %} uk-badge-warning{% else %} uk-badge-white{% endif %} uk-padding-small uk-padding-remove-vertical" data-uk-tooltip="{{ employee.status }}">
                                        {{ employee.status.id }}
                                    </span>
                                    {% endif %}
                                </div>
                                <div class="uk-grid-small uk-flex uk-flex-middle uk-text-meta" data-uk-grid>
                                    <div>
                                        <span class="clipboard" uk-tooltip="Click2Copy" data-clipboard-action="copy" data-clipboard-text="{{ employee.id }}" >
                                            <i class="fas fa-hashtag"></i> {{ employee.id }}
                                        </span>
                                    </div>
                                    <div>
                                        <span class="clipboard" uk-tooltip="Click2Copy" data-clipboard-action="copy" data-clipboard-text="{{ employee.username }}">
                                            <i class="fa-solid fa-user-tag"></i> {{ employee.username }}
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <div class="uk-width-auto">
                                <a href="https://flaglerschools.jamfcloud.com/users.html?query={{ employee.username }}" target="_blank">
                                    <span data-uk-tooltip="See in JAMF">
                                        <img src="{% static 'img/icons/jamf-favicon.png' %}" alt=“JAMF” />
                                    </span>
                                </a>
                            </div>
                            {% if not id_only %}
                            <div class="uk-width-auto">
                                {% if employee.iiq_id %}
                                <a href="https://flaglerschools.incidentiq.com/agent/users/{{ employee.iiq_id }}" target="_blank">
                                    <span data-uk-tooltip="See in IIQ">
                                        <img src="{% static 'img/icons/incidentiq.png' %}" alt="IncidentIQ" />
                                    </span>
                                </a>
                                {% else %}
                                <span data-uk-tooltip="No IIQ UUID">
                                    <img src="{% static 'img/icons/incidentiq.png' %}" alt="IncidentIQ" style="opacity:0.5" />
                                </span>
                                {% endif %}
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div> -->
        <!-- /EMPLOYEE HEADER -->
        <!-- EMPLOYEE INFORMATION -->
        <div>
            <div class="uk-grid-small uk-child-width-1-1 uk-child-width-1-2@m" data-uk-grid>
                <div>
                    <div class="uk-card uk-card-default uk-card-small">
                        <div class="uk-card-header">
                            <div class="uk-grid-small uk-flex uk-flex-middle" data-uk-grid>
                                <div class="uk-width-expand">
                                    <span class="uk-text-large">
                                        Employee Profile
                                    </span>
                                </div>
                                <div class="uk-width-auto">
                                    Registration:
                                    {% if ddata and ddata_date %}
                                    <a class="{% if ddata_date == '22-23' %}uk-text-success{% elif ddata_date == '21-22' %}uk-text-warning{% endif %}" data-uk-toggle="target: #dlm-details">{{ ddata_date }}</a>
                                    {% else %}
                                    <i class="fa-regular fa-times-circle uk-text-danger"></i>
                                    {% endif %}
                                </div>
                                <div class="uk-width-auto">
                                    Payment:
                                    {% if ddata.payment_complete and ddata_date == '22-23' %}
                                    <a data-uk-toggle="target: #dlm-details"><i class="far fa-check-circle uk-text-success"></i></a>
                                    {% else %}
                                    <i class="far fa-times-circle uk-text-danger"></i>
                                    {% endif %}
                                </div>
                                <div class="uk-width-auto">
                                    <a id="employee-profile-action" class="uk-button uk-button-default uk-button-small uk-width-small">
                                        Action<i class="fas fa-angle-down" style="margin-left:5px"></i>
                                    </a>
                                    <div class="uk-text-left uk-dropdown-close" data-uk-dropdown="mode: click; pos: bottom-right; offset: 2; animation: uk-animation-slide-top-small; duration: 200">
                                        <ul id="employee-dropdown" class="employee-dropdown uk-dropdown-nav" data-uk-nav>
                                            {% if employee.status_id == 'IT' and is_admin %}
                                            <li>
                                                {% if employee.iiq_id %}
                                                <a id="profile-complete-transfer" class="uk-text-warning"><i class="fa-light fa-dolly fa-fw uk-margin-small-right"></i>Complete Transfer</a>
                                                {% else %}
                                                <span class="uk-text-muted"><i class="fa-light fa-dolly fa-fw uk-margin-small-right"></i>Complete Transfer</span>
                                                {% endif %}
                                            </li>
                                            {% endif %}
                                            <li>
                                                <a id="employee-note-transactions" class="uk-text-secondary" data-uk-toggle="#note-transactions"><i class="fa-solid fa-history fa-fw uk-margin-small-right"></i>Note History</a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="uk-card-body">
                            <div id="profile-data">
                                <table>
                                    <tbody>
                                        <tr>
                                            <td class="uk-text-bold">Status:</td>
                                            <td>
                                                {{ employee.status }}{% if employee.status_id == 'IT' %} ({{ transfer_record.transfer_to.name }}){% endif %}
                                                {% if employee.status_id == 'SP' %}
                                                {% if summer_program_record %}({{ summer_program_record.program.id }}){% else %}(Unknown){% endif %}
                                                {% endif %}
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="uk-text-bold">Location:</td>
                                            <td>
                                                <span uk-tooltip="{{ employee.location_code }}">
                                                    {{ employee.location.name }}
                                                </span>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="uk-text-bold">Grade:</td>
                                            <td>{{ employee.get_grade_full }}</td>
                                        </tr>
                                        {% if employee.graduation_date != None %}
                                        <tr>
                                            <td class="uk-text-bold">Graduation:</td>
                                            <td>{{ employee.graduation_date|date:'Y' }}</td>
                                        </tr>
                                        {% endif %}
                                        {% if employee.birthdate != None %}
                                        <tr>
                                            <td class="uk-text-bold">Birthdate:</td>
                                            <td>{{ employee.birthdate|date:'F jS, Y' }}</td>
                                        </tr>
                                        {% endif %}
                                        <tr>
                                            <td colspan="2">
                                                <button type="button" class="clipboard uk-button uk-button-default uk-button-small uk-border-rounded" style="font-size:75%;padding:0 8px;line-height:18px" data-uk-toggle="target: #employee-tempid">
                                                    <i class="fa-light fa-barcode" style="margin-right:6px"></i>Temporary ID
                                                </button>
                                            </td>
                                        </tr>
                                        {% if not id_only %}
                                        <tr>
                                            <td>
                                                <hr class="uk-margin-top" />
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="uk-text-bold" uk-toggle="target: #change-password-modal"><span data-uk-tooltip="Click2Change">Password:</span></td>
                                            <td>
                                                <span class="clipboard" uk-tooltip="Click2Copy" data-clipboard-action="copy" data-clipboard-text="{{ employee.password }}">{{ employee.password }}</span>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td colspan="2">
                                                <button type="button" class="clipboard uk-button uk-button-default uk-button-small uk-border-rounded" style="font-size:75%;padding:0 8px;line-height:18px" data-uk-toggle="target: #employee-infolabel">
                                                    <i class="fa-light fa-barcode" style="margin-right:6px"></i>Information Label
                                                </button>
                                            </td>
                                        </tr>
                                        {% endif %}
                                        <tr>
                                            <td>
                                                <hr class="uk-margin-top" />
                                            </td>
                                        </tr>
                                        {% if not id_only %}
                                        <tr>
                                            <td class="uk-text-bold">IIQ ID:</td>
                                            <td>
                                                {% if employee.iiq_id %}
                                                {{ employee.iiq_id }}
                                                {% else %}
                                                <a id="get-iiq-id" class="uk-text-danger">Get IIQ UUID</a>
                                                {% endif %}
                                            </td>
                                        </tr>
                                        {% endif %}
                                    </tbody>
                                </table>
                            </div>
                            <div id="note-items" class="uk-margin-top">
                                {% for note in notes|slice:":5" %}
                                <div class="uk-grid-small uk-flex uk-flex-middle uk-margin" data-uk-grid>
                                    {% if is_admin %}
                                    <div class="uk-width-auto">
                                        <form id="delete-note-form" method="POST">
                                            <input type="hidden" value="{{ note.id }}" />
                                            <button type="submit" class="uk-icon-button uk-button-danger" data-uk-tooltip="Delete Note"><i class="fas fa-times"></i></button>
                                        </form>
                                    </div>
                                    {% endif %}
                                    <div class="uk-width-expand">
                                        {{ note.body }}
                                        <div class="uk-text-meta">
                                            {{ note.author.get_full_name }} &mdash; {{ note.created|date:'F d, Y' }} &mdash; {{ note.created|date:'g:i A' }}
                                        </div>
                                    </div>
                                </div>
                                {% empty %}
                                <div class="uk-margin">
                                    There are currently no notes on file.
                                </div>
                                {% endfor %}
                                {% if notes.count > 5 %}
                                <div id="expand-notes-container" class="uk-hidden">
                                    {% for note in notes|slice:"5:" %}
                                    <div class="uk-grid-small uk-flex uk-flex-middle uk-margin" data-uk-grid>
                                        {% if is_admin %}
                                        <div class="uk-width-auto">
                                            <form id="delete-note-form" method="POST">
                                                <input type="hidden" value="{{ note.id }}" />
                                                <button type="submit" class="uk-icon-button uk-button-danger" data-uk-tooltip="Delete Note"><i class="fas fa-times"></i></button>
                                            </form>
                                        </div>
                                        {% endif %}
                                        <div class="uk-width-expand">
                                            {{ note.body }}
                                            <div class="uk-text-meta">
                                                {{ note.author.get_full_name }} &mdash; {{ note.created|date:'F d, Y' }} &mdash; {{ note.created|date:'g:i A' }}
                                            </div>
                                        </div>
                                    </div>
                                    {% empty %}
                                    <div class="uk-margin">
                                        There are currently no additional notes on file.
                                    </div>
                                    {% endfor %}
                                </div>
                                <div class="uk-text-center uk-margin">
                                    <a id="expand-notes-request" data-open="false">
                                        <i class="fa-solid fa-chevrons-down uk-margin-small-right"></i>See more...
                                    </a>
                                </div>
                                {% endif %}
                                <script>
                                    var expandNotesContainer = document.getElementById("expand-notes-container");
                                    var expandNotesRequest = document.getElementById("expand-notes-request");

                                    if (expandNotesRequest != null) {
                                        expandNotesRequest.addEventListener("click", function(event) {
                                            expandNotesContainer.classList.toggle("uk-hidden");

                                            if (this.dataset.open == 'false') {
                                                this.dataset.open = 'true';
                                                this.innerHTML = `<i class="fa-solid fa-chevrons-up uk-margin-small-right"></i>See less...`;
                                            } else {
                                                this.dataset.open = 'false';
                                                this.innerHTML = `<i class="fa-solid fa-chevrons-down uk-margin-small-right"></i>See more...`;
                                            }
                                        });
                                    }
                                </script>
                                {% if not id_only %}
                                <form id="add-note-form" method="POST">
                                    {% csrf_token %}
                                    <textarea id="add-note-body" rows="3" class="uk-textarea" style="resize: none" required></textarea>
                                    <div class="uk-margin-small-top uk-text-right">
                                        <button id="add-note-submit" type="submit" class="uk-button uk-button-danger uk-button-small uk-width-small">Add Note</button>
                                    </div>
                                </form>
                                {% endif %}
                            </div>
                        </div>
                        <div id="note-transactions" class="uk-modal-full" data-uk-modal>
                            <div class="uk-modal-dialog" data-uk-height-viewport>
                                <button type="button" class="uk-modal-close-full uk-close-large" data-uk-close></button>
                                <div class="uk-modal-header">
                                    <h2 class="uk-modal-title">Note History</h2>
                                </div>
                                <div class="uk-modal-body uk-padding-remove">
                                    <table class="uk-table uk-table-small uk-table-middle uk-table-divider uk-margin-remove">
                                        <thead>
                                            <th style="width: 75px">Type</th>
                                            <th style="width: 150px">User</th>
                                            <th style="width: 150px">Date</th>
                                            <th>Note</th>
                                        </thead>
                                        <tbody>
                                            {% for record in historical_notes %}
                                            <tr>
                                                <td class="uk-text-center" style="padding-left: 15px">
                                                    {% if record.history_type == '+' %}
                                                    <span class="uk-label uk-label-success uk-width-1-1">ADD</span>
                                                    {% elif record.history_type == '-' %}
                                                    <span class="uk-label uk-label-danger uk-width-1-1">DELETE</span>
                                                    {% elif record.history_type == '~' %}
                                                    <span class="uk-label uk-width-1-1">CHANGE</span>
                                                    {% endif %}
                                                </td>
                                                <td>
                                                    {% if record.history_user %}
                                                    {{ record.history_user.username }}
                                                    {% else %}
                                                    System Admin
                                                    {% endif %}
                                                </td>
                                                <td>{{ record.history_date|date:'m-d-Y' }} <span class="uk-text-meta">{{ record.history_date|date:'h:i A' }}</span></td>
                                                <td style="padding-right: 15px">{{ record.body }}</td>
                                            </tr>
                                            {% empty %}
                                            <tr>
                                                <td colspan="4" class="uk-text-center">No records to display.</td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% if not id_only %}
                    {% if cdata %}
                    <div class="uk-card uk-card-default uk-card-small" style="margin-top:15px">
                        <div class="uk-card-header">
                            <div class="uk-grid-small uk-flex uk-flex-middle" data-uk-grid>
                                <div class="uk-width-expand">
                                    <span class="uk-text-large">Collection Data</span>
                                </div>
                                <div class="uk-width-auto uk-text-bold uk-text-right">
                                    {{ cdata.created|date:'F jS, Y' }}
                                    <br /><span class="uk-text-meta" style="font-weight:400">{{ cdata.author.get_full_name }}</span>
                                </div>
                            </div>
                        </div>
                        <div class="uk-card-body">
                            <div class="uk-grid-small uk-child-width-1-2" data-uk-grid>
                                <div>
                                    <div class="uk-margin-small">
                                        <b>BPI:</b> <a href="{% url 'assets:detail' cdata.device.id %}" target="_blank">{{ cdata.device.id }}</a>
                                        <br /><b>Bin:</b> {{ cdata.device_bin }}
                                    </div>
                                    <div class="uk-margin-small">
                                        <b>{{ cdata.get_device_return_type_display }}</b>
                                        {% if cdata.device_damage_present %}
                                        <br />Damaged: ...
                                        {% else %}
                                        <br />No Damage
                                        {% endif %}
                                    </div>
                                    <div class="uk-margin-small">
                                        <b>{{ cdata.get_charger_return_type_display }}</b>
                                        {% if cdata.charger_return_type == 'CR' %}
                                        <br />Yes
                                        {% else %}
                                        <br />No
                                        {% endif %}
                                    </div>
                                </div>
                                <div>
                                    <div class="uk-margin-small">
                                        <b>Next School:</b> {{ cdata.employee_next_location }}
                                        <br /><b>Next Grade:</b> {{ cdata.employee_next_grade|ordinal }}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                    {% endif %}
                </div>
                <div>
                    <div class="uk-grid-small uk-child-width-1-1" data-uk-grid>
                        <div>
                            <div id="asset-data" class="uk-card uk-card-default uk-card-small">
                                <div class="uk-card-header">
                                    <div class="uk-grid-small uk-flex uk-flex-middle" data-uk-grid>
                                        <div class="uk-width-expand">
                                            <span class="uk-text-large">Assets</span>
                                        </div>
                                        {% if not id_only %}
                                        <div class="uk-width-auto">
                                            <a id="employee-assets-action" class="uk-button uk-button-default uk-button-small uk-width-small">
                                                Action<i class="fas fa-angle-down" style="margin-left:5px"></i>
                                            </a>
                                            <div class="uk-text-left uk-dropdown-close" uk-dropdown="mode: click; pos: bottom-right; offset: 2; animation: uk-animation-slide-top-small; duration: 200">
                                                <ul class="employee-dropdown uk-dropdown-nav" data-uk-nav>
                                                    <li>
                                                        <span class="uk-text-muted"><i class="fas fa-cloud-download-alt fa-fw uk-margin-small-right"></i>Pull Assets (IIQ)</span>
                                                    </li>
                                                    <li>
                                                        <i class="fas fa-history fa-fw uk-margin-small-right"></i>Asset History
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="uk-card-body">
                                    <div class="uk-grid-small uk-child-width-1-1" data-uk-grid>
                                        <div>
                                            <div class="uk-grid-collapse uk-heading-divider" style="padding-bottom:4px" data-uk-grid>
                                                <div class="uk-text-bold uk-width-expand">
                                                    Devices
                                                </div>
                                                {% if not id_only %}
                                                <div class="uk-width-auto uk-margin-small-right uk-flex uk-flex-middle">
                                                    {% if not ddata_date_valid %}
                                                    <a data-uk-toggle="#assignment-dlmr-warning-modal"><i class="fas fa-plus" style="padding-right:3px;"></i>Add</a>
                                                    <!-- ASSIGNMENT WARNING -->
                                                    <div id="assignment-dlmr-warning-modal" data-uk-modal>
                                                        <div class="uk-modal-dialog">
                                                            <div class="uk-modal-header">
                                                                <h2 class="uk-modal-title">Assignment Confirmation</h2>
                                                            </div>
                                                            <div class="uk-modal-body">
                                                                <div class="uk-margin-small">
                                                                    This user does not have a completed Digital Learning Movement Registration! Please do not assign the user a device without this form.
                                                                </div>
                                                            </div>
                                                            <div class="uk-modal-footer uk-text-right">
                                                                <a class="uk-button uk-button-danger" data-uk-toggle="#add-device">Override</a>
                                                                <a class="uk-button uk-button-default uk-modal-close">Cancel</a>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <!-- /ASSIGNMENT WARNING -->
                                                    {% else %}
                                                        {% if assignment_warning %}
                                                        <a data-uk-toggle="#assignment-warning-modal"><i class="fas fa-plus" style="padding-right:3px;"></i>Add</a>
                                                        {% else %}
                                                        <a data-uk-toggle="#add-device"><i class="fas fa-plus" style="padding-right:3px;"></i>Add</a>
                                                        {% endif %}
                                                    {% endif %}
                                                </div>
                                                {% endif %}
                                            </div>
                                            {% for device, property in assigned_devices.items %}
                                            <div class="item-container uk-position-relative uk-link-reset uk-margin-small">
                                                <div class="uk-flex uk-flex-middle">
                                                    <div style="padding-left:5px;padding-right:10px">
                                                        {% if property.manufacturer == "Apple" %}
                                                        <img src="{% static 'img/devices/manufacturer_apple.png' %}" alt="Error" class="uk-border-circle" style="width:48px" />
                                                        {% elif property.manufacturer == "HP" %}
                                                        <img src="{% static 'img/devices/manufacturer_hp.png' %}" alt="Error" class="uk-border-circle" style="width:48px" />
                                                        {% elif property.manufacturer == "Motorola" %}
                                                        <img src="{% static 'img/devices/manufacturer_moto.png' %}" alt="Error" class="uk-border-circle" style="width:48px" />
                                                        {% elif property.manufacturer == "Sprint" %}
                                                        <img src="{% static 'img/devices/manufacturer_sprint.png' %}" alt="Error" class="uk-border-circle" style="width:48px" />
                                                        {% elif property.manufacturer == "T-Mobile" %}
                                                        <img src="{% static 'img/devices/manufacturer_tmobile.png' %}" alt="Error" class="uk-border-circle" style="width:48px" />
                                                        {% elif property.manufacturer == "Verizon" %}
                                                        <img src="{% static 'img/devices/manufacturer_verizon.png' %}" alt="Error" class="uk-border-circle" style="width:48px" />
                                                        {% else %}
                                                        <i class="fas fa-laptop fa-2x"></i>
                                                        {% endif %}
                                                    </div>
                                                    <div class="uk-width-expand">
                                                        <span class="uk-text-bold">{{ property.model }}</span>
                                                        <div class="uk-text-small">
                                                            <i class="fas fa-hashtag"></i> {{ device }}
                                                            <div class="uk-text-meta uk-grid-small" data-uk-grid>
                                                                {% if property.date_assigned != None %}
                                                                <div>
                                                                    <span data-uk-tooltip="Assigned Date"><i class="far fa-fw fa-calendar-plus"></i> {{ property.date_assigned|date:'m-d-Y' }}</span>
                                                                    <span class="uk-margin-small-left" data-uk-tooltip="Assigner">
                                                                        <i class="fas fa-fw fa-user"></i>
                                                                        {% if property.assigner != None %}
                                                                        {{ property.assigner }}
                                                                        {% else %}
                                                                        sysadmin
                                                                        {% endif %}
                                                                    </span>
                                                                </div>
                                                                {% endif %}
                                                                {% if property.expiration %}
                                                                <div>
                                                                    <span class="uk-text-meta" data-uk-tooltip="Expiration Date">
                                                                        {% if summer_program_record %}
                                                                        <i class="fas fa-fw fa-clock"></i> {{ summer_program_record.program.expiration|date:'m-d-Y' }}
                                                                        {% else %}
                                                                        <i class="fas fa-fw fa-clock"></i> {{ property.expiration|date:'m-d-Y' }}
                                                                        {% endif %}
                                                                    </span>
                                                                </div>
                                                                {% endif %}
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="uk-flex uk-flex-middle">
                                                        <div>
                                                            <a href="{% url 'assets:detail' device %}" data-uk-tooltip="View Device">
                                                                <i class="fas fa-fw fa-file-alt uk-text-primary"></i>
                                                            </a>
                                                        </div>
                                                        {% if not id_only %}
                                                        <div>
                                                            <a class="checkin-device-button" data-deviceid="{{ device }}" data-ownerid="{{ employee.id }}" data-uk-tooltip="Check-in Device">
                                                                <i class="fas fa-fw fa-inbox-in uk-text-danger"></i>
                                                            </a>
                                                        </div>
                                                        {% endif %}
                                                    </div>
                                                </div>
                                            </div>
                                            {% empty %}
                                            <div class="uk-margin-small">
                                                No devices are currently assigned to this user.
                                            </div>
                                            {% endfor %}
                                            <script>
                                            $(document).ready(function() {
                                                $(".checkin-device-button").each(function() {
                                                    var $this = $(this);

                                                    $this.on("click", function(event) {
                                                        event.preventDefault();

                                                        $.ajax({
                                                            url: "{% url 'users:get_device' %}",
                                                            type: "POST",
                                                            data: {
                                                                csrfmiddlewaretoken: $("#modify-device input[name=csrfmiddlewaretoken]").val(),
                                                                device_id: $this.data("deviceid"),
                                                                owner_id: $this.data("ownerid"),
                                                                user_email: "{{ employee_email }}"
                                                            },
                                                            success: function(response) {
                                                                openOffcanvas(response);
                                                            },
                                                            error: function(xhr) {
                                                                console.log(xhr.status + ": " + xhr.responseText);
                                                            }
                                                        });

                                                        function openOffcanvas(data) {
                                                            $("#modify-device-content").replaceWith(data);
                                                            UIkit.offcanvas("#modify-device").show();
                                                        }
                                                    });
                                                });
                                            });
                                            </script>
                                        </div>
                                        <div>
                                            <div class="uk-grid-collapse uk-heading-divider" style="padding-bottom:4px" data-uk-grid>
                                                <div class="uk-text-bold uk-width-expand">
                                                    Peripherals
                                                </div>
                                                {% if not id_only %}
                                                <div class="uk-width-auto uk-margin-small-right uk-flex uk-flex-middle">
                                                    <a data-uk-toggle="target: #add-charger"><i class="fas fa-plus" style="padding-right:3px;"></i>Add</a>
                                                </div>
                                                {% endif %}
                                            </div>
                                            {% for charger, property in assigned_chargers.items %}
                                            <div class="item-container uk-margin-small uk-position-relative">
                                                <div class="uk-flex uk-flex-middle">
                                                    <div style="padding-left:5px;padding-right:10px">
                                                        <i class="fas fa-fw fa-2x fa-battery-bolt"></i>
                                                    </div>
                                                    <div class="uk-width-expand">
                                                        <div class="uk-grid-small uk-flex uk-flex-middle" data-uk-grid>
                                                            <div>
                                                                <span class="uk-text-bold">{{ property.name }}</span>
                                                            </div>
                                                            {% if not 'MagSafe' in property.name %}
                                                            <div>
                                                                {% if property.adapter %}
                                                                <span class="uk-text-success uk-text-bold" data-uk-tooltip="Charging Brick"><i class="fas fa-fw fa-plug"></i></span>
                                                                {% else %}
                                                                <span class="uk-text-danger uk-text-bold" data-uk-tooltip="Charging Brick"><i class="fas fa-fw fa-plug"></i></span>
                                                                {% endif %}
                                                                {% if property.cord %}
                                                                <span class="uk-text-success uk-text-bold" data-uk-tooltip="Charging Cord"><i class="fab fa-fw fa-usb"></i></span>
                                                                {% else %}
                                                                <span class="uk-text-danger uk-text-bold" data-uk-tooltip="Charging Cord"><i class="fab fa-fw fa-usb"></i></span>
                                                                {% endif %}
                                                                </div>
                                                            {% endif %}
                                                        </div>
                                                        <div class="uk-text-small">
                                                            <div class="uk-text-meta uk-grid-small" data-uk-grid>
                                                                {% if property.assigned_date %}
                                                                <div>
                                                                    <span data-uk-tooltip="Assigned Date"><i class="far fa-fw fa-calendar-plus"></i> {{ property.assigned_date }}</span>
                                                                </div>
                                                                <div>
                                                                    <span data-uk-tooltip="Assigner">
                                                                        <i class="fas fa-fw fa-user"></i>
                                                                        {% if property.assigned_author != None %}
                                                                        {{ property.assigned_author }}
                                                                        {% else %}
                                                                        sysadmin
                                                                        {% endif %}
                                                                    </span>
                                                                </div>
                                                                {% endif %}
                                                            </div>
                                                        </div>
                                                    </div>
                                                    {% if not id_only %}
                                                    <div class="uk-flex uk-flex-middle">
                                                        <div>
                                                            <a class="modify-charger-button" data-chargerid="{{ charger }}" data-uk-tooltip="Edit Peripheral">
                                                                <i class="fas fa-fw fa-edit uk-text-danger"></i>
                                                            </a>
                                                        </div>
                                                    </div>
                                                    {% endif %}
                                                </div>
                                            </div>
                                            {% empty %}
                                            <div class="uk-margin-small">
                                                No peripherals are currently assigned to this user.
                                            </div>
                                            {% endfor %}
                                            <script>
                                            $(document).ready(function() {
                                                $(".modify-charger-button").each(function() {
                                                    var $this = $(this);

                                                    $this.on("click", function(event) {
                                                        event.preventDefault();

                                                        $.ajax({
                                                            url: "{% url 'users:get_charger' %}",
                                                            type: "POST",
                                                            data: {
                                                                csrfmiddlewaretoken: $("#modify-charger input[name=csrfmiddlewaretoken]").val(),
                                                                charger_id: $this.data("chargerid"),
                                                                modify: "False"
                                                            },
                                                            success: function(response) {
                                                                openOffcanvas(response);
                                                            },
                                                            error: function(xhr) {
                                                                console.log(xhr.status + ": " + xhr.responseText);
                                                            }
                                                        });

                                                        function openOffcanvas(data) {
                                                            $("#modify-charger-content").replaceWith(data);
                                                            UIkit.offcanvas("#modify-charger").show();
                                                        }
                                                    });
                                                });
                                            });
                                            </script>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div>
                            <div id="fine-data" class="uk-card uk-card-default uk-card-small">
                                <div class="uk-card-header">
                                    <div class="uk-grid-small uk-flex uk-flex-middle" data-uk-grid>
                                        <div class="uk-width-expand">
                                            <span class="uk-text-large">Fines Information</span>
                                        </div>
                                        {% if not id_only %}
                                        <div class="uk-width-auto">
                                            <a class="uk-button uk-button-primary uk-button-small uk-width-small" data-uk-toggle="target: #fines-add">Add Fine</a>
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="uk-card-body">
                                    <div id="fine-items" class="uk-grid-small uk-child-width-1-1" data-uk-grid>
                                        <div>
                                            <ul class="uk-child-width-expand" data-uk-tab>
                                                <li id="fines-tab-unpaid" class="uk-active">
                                                    <a href=""><i class="fas fa-dollar-sign fa-fw"></i> Unpaid Fines</a>
                                                </li>
                                                <li id="fines-tab-paid">
                                                    <a href=""><i class="fas fa-hand-holding-usd uk-margin-small-left"></i> Paid Fines</a>
                                                </li>
                                                <li id="fines-tab-history">
                                                    <a data-uk-toggle="target: #fine-transactions"><i class="fas fa-history fa-fw uk-margin-small-right"></i>Legacy Information</a>
                                                </li>
                                            </ul>
                                            <ul class="uk-switcher uk-margin">
                                                <li id="fines-content-unpaid">
                                                    {% for transgression, data in employee_unpaid_fee_list.items %}
                                                    <div class="item-container uk-margin-small">
                                                        <div class="uk-flex uk-flex-middle">
                                                            <div class="uk-padding-small uk-padding-remove-vertical">
                                                                 <span data-uk-tooltip="Fine Amount"><i class="fas fa-dollar-sign fa-fw"></i>{{ data.amount|floatformat:0 }}</span>
                                                            </div>
                                                            <div class="uk-width-expand">
                                                                <span class="uk-text-bold">{{ data.name }}</span>
                                                                <div class="uk-text-small">
                                                                    <div class="uk-text-meta uk-grid-small" data-uk-grid>
                                                                        <div>
                                                                            <span class="clipboard" data-uk-tooltip="Invoice Number" data-clipboard-action="copy" data-clipboard-text="{{ data.id }}"><i class="fas fa-hashtag"></i> {{ data.id }}</span>
                                                                            <span data-uk-tooltip="Date Assessed"><i class="far fa-calendar-plus uk-margin-small-left"></i> {{ data.created }}</span>
                                                                            <a class="uk-link-reset clipboard" href="https://www.myschoolbucks.com/ver2/admin/cashier/listinvoices" target="_blank" data-uk-tooltip="Amount Paid" data-clipboard-action="copy" data-clipboard-text="{{ data.id }}"><i class="fas fa-hand-holding-usd uk-margin-small-left"></i> {{ data.amount_paid }}</a>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    {% empty %}
                                                    <div class="uk-text-center">
                                                        <p class="uk-margin-remove">There are currently no unpaid <a href="https://www.myschoolbucks.com/ver2/admin/cashier/listinvoices" target="_blank">MySchoolBucks</a> fines on file.
                                                        <br />Select "Legacy Information" above to view legacy fines and payments.</p>
                                                    </div>
                                                    {% endfor %}
                                                </li>
                                                <li id="fines-content-paid">
                                                    {% for transgression, data in employee_paid_fee_list.items %}
                                                    <div class="item-container uk-margin-small">
                                                        <div class="uk-flex uk-flex-middle">
                                                            <div class="uk-padding-small uk-padding-remove-vertical">
                                                                 <span data-uk-tooltip="Fine Amount"><i class="fas fa-dollar-sign fa-fw"></i>{{ data.amount|floatformat:0 }}</span>
                                                            </div>
                                                            <div class="uk-width-expand">
                                                                <span class="uk-text-bold">{{ data.name }}</span>
                                                                <div class="uk-text-small">
                                                                    <div class="uk-text-meta uk-grid-small" data-uk-grid>
                                                                        <div>
                                                                            <span class="clipboard" data-uk-tooltip="Invoice Number" data-clipboard-action="copy" data-clipboard-text="{{ data.id }}"><i class="fas fa-hashtag"></i> {{ data.id }}</span>
                                                                            <span data-uk-tooltip="Date Assessed"><i class="far fa-calendar-plus uk-margin-small-left"></i> {{ data.created }}</span>
                                                                            <a class="uk-link-reset clipboard" href="https://www.myschoolbucks.com/ver2/admin/cashier/listinvoices" target="_blank" data-uk-tooltip="Amount Paid" data-clipboard-action="copy" data-clipboard-text="{{ data.id }}"><i class="fas fa-hand-holding-usd uk-margin-small-left"></i> {{ data.amount_paid }}</a>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    {% empty %}
                                                    <div class="uk-text-center">
                                                        <p class="uk-margin-remove">There are currently no paid <a href="https://www.myschoolbucks.com/ver2/admin/cashier/listinvoices" target="_blank">MySchoolBucks</a> fines on file.</p>
                                                    </div>
                                                    {% endfor %}
                                                </li>
                                                <li id="fines-content-history" class="uk-text-center">
                                                    Legacy fines and payments should open in a separate modal window.
                                                    <br />If it doesn't or you need to re-access the screen, click on the tab again.
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- FINE HISTORY -->
                            <div id="fine-transactions" class="uk-modal-full" data-uk-modal>
                                <div class="uk-modal-dialog" data-uk-height-viewport>
                                    <button class="uk-modal-close-full uk-close-large" type="button" data-uk-close></button>
                                    <div class="uk-modal-header">
                                        <h2 class="uk-modal-title">Legacy Fines & Payments</h2>
                                    </div>
                                    <div class="uk-modal-body uk-padding-remove">
                                        <h3 class="uk-margin-medium-left uk-margin-medium-top">Legacy Fines</h3>
                                        <table class="uk-table uk-table-small uk-table-middle uk-table-divider" style="margin-top: 0">
                                            <thead>
                                                <th style="width:80px">Type</th>
                                                <th style="width:150px">User</th>
                                                <th style="width:125px">Date</th>
                                                <th class="uk-width-medium">Fine</th>
                                                <th style="width:80px">Amount</th>
                                                <th class="uk-width-large">Description</th>
                                                <th style="width:125px">Status</th>
                                                <th>Note</th>
                                            </thead>
                                            <tbody>
                                                {% for record in historical_fines %}
                                                <tr>
                                                    <td class="uk-text-center" style="padding-left: 15px">
                                                        {% if record.history_type == '+' %}
                                                        <span class="uk-label uk-label-success uk-width-1-1">ADDED</span>
                                                        {% elif record.history_type == '-' %}
                                                        <span class="uk-label uk-label-danger uk-width-1-1">DELETED</span>
                                                        {% elif record.history_type == '~' %}
                                                        <span class="uk-label uk-width-1-1">CHANGED</span>
                                                        {% endif %}
                                                    </td>
                                                    <td>
                                                        {% if record.history_user %}
                                                        {{ record.history_user.get_full_name }}
                                                        {% else %}
                                                        System Administrator
                                                        {% endif %}
                                                    </td>
                                                    <td>
                                                        {{ record.history_date|date:'m-d-Y' }}
                                                        <br /><span class="uk-text-meta">{{ record.history_date|date:'h:i A' }}</span>
                                                    </td>
                                                    <td>
                                                        {{ record.fine_type.name }}
                                                        <br />{{ record.fine_subtype.name }}
                                                    </td>
                                                    <td>
                                                        {% if record.fine_type.alias == 'IP1I' or record.fine_type.alias == 'IP2I' or record.fine_type.alias == 'MB1I' or record.fine_type.alias == 'MB2I' %}
                                                        ${{ record.fine_type.value }}
                                                        {% elif record.fine_subtype != None %}
                                                        ${{ record.fine_subtype.value }}
                                                        {% else %}
                                                        Error
                                                        {% endif %}
                                                    </td>
                                                    <td>
                                                        {{ record.fine_type.description }}
                                                        <br />{{ record.fine_subtype.description }}
                                                    </td>
                                                    <td>{{ record.get_status_display }}</td>
                                                    <td style="padding-right: 15px">{{ record.history_change_reason }}</td>
                                                </tr>
                                                {% empty %}
                                                <tr>
                                                    <td colspan="8" class="uk-text-center">No records to display.</td>
                                                </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                        <h3 class="uk-margin-medium-left uk-margin-medium-top">Legacy Payments</h3>
                                        <table class="uk-table uk-table-small uk-table-middle uk-table-divider" style="margin-top: 0">
                                            <thead>
                                                <th style="width:80px">User</th>
                                                <th style="width:125px">Date</th>
                                                <th class="uk-width-medium">Description</th>
                                                <th style="width:80px">Amount</th>
                                                <th style="width:125px">Paid</th>
                                                <th>Payer Name</th>
                                                <th>Payer Email</th>
                                            </thead>
                                            <tbody>
                                                {% for record in schoolpay_data %}
                                                <tr>
                                                    <td class="uk-text-center" style="padding-left: 15px">
                                                        {{ record.author }}
                                                    </td>
                                                    <td>
                                                        {{ record.timestamp }}
                                                    </td>
                                                    <td>
                                                        {{ record.description }}
                                                    </td>
                                                    <td>
                                                        ${{ record.amount }}
                                                    </td>
                                                    <td>
                                                        ${{ record.paid }}
                                                    </td>
                                                    <td>
                                                        {{ record.payer_name }}
                                                    </td>
                                                    <td>
                                                        {{ record.payer_email }}
                                                    </td>
                                                </tr>
                                                {% empty %}
                                                <tr>
                                                    <td colspan="7" class="uk-text-center">No records to display.</td>
                                                </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            <!-- /FINE HISTORY -->
                        </div>
                        {% if not id_only %}
                        <div>
                            <div class="uk-card uk-card-default uk-card-small">
                                <div class="uk-card-header">
                                    <div class="uk-grid-small uk-flex uk-flex-middle" data-uk-grid>
                                        <div class="uk-width-expand">
                                            <span class="uk-text-large">Staging Data</span>
                                        </div>
                                        <div class="uk-width-auto uk-text-bold uk-text-right">
                                            {{ staging_data.created|date:'F jS, Y' }}
                                            <br /><span class="uk-text-meta" style="font-weight:400">{{ staging_data.author }}</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="uk-card-body">
                                    <!-- STAGING INFORMATION -->
                                    <div id="staging-data">
                                        <form id="update-staging-form" class="uk-form-stacked" method="POST">
                                            {% csrf_token %}
                                            <div class="uk-grid-small uk-child-width-1-2" data-uk-grid>
                                                <div>
                                                    <label class="uk-form-label uk-text-bold" for="form-stacked-text">Device Bin:</label>
                                                    <div class="uk-form-controls">
                                                        <input class="uk-input" id="staging-bin" type="text" placeholder="Enter bin..." value="{{ staging_data.bin }}" maxlength="10" required />
                                                    </div>
                                                </div>
                                                <div>
                                                    <label class="uk-form-label uk-text-bold" for="form-stacked-text">Device BPI:</label>
                                                    <div class="uk-form-controls">
                                                        <input class="uk-input" id="staging-bpi" type="text" placeholder="Enter BPI..." value="{{ staging_data.bpi }}" required />
                                                    </div>
                                                </div>
                                                {% if l5qdata_exists and l5qdata.iiq_ticket != None %}
                                                {% if l5qdata.iiq_ticket != '' %}
                                                <div class="uk-width-1-1">
                                                    <label class="uk-form-label uk-text-warning" for="form-stacked-text">
                                                        There is currently an <a href="https://flaglerschools.incidentiq.com/agent/tickets/open?flyout-type=agent-ticket&flyout-id={{ l5qdata.iiq_ticket }}" target="_blank">IncidentIQ ticket <i class="fas fa-external-link-alt"></i></a> attached to the next staging event. Please make sure that the ticket's actions are updated before staging and enter the ticket number below to close it:
                                                    </label>
                                                    <div class="uk-form-controls">
                                                        <input class="uk-input" id="iiq-ticket-number" type="text" placeholder="Enter ticket number..." required />
                                                    </div>
                                                </div>
                                                {% endif %}
                                                {% endif %}
                                            </div>
                                            <div class="uk-margin-small uk-width-1-1 uk-text-right">
                                                <button type="submit" class="uk-button uk-button-small uk-button-danger uk-width-small">Update</button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        <!-- /employee INFORMATION -->
    </div>
</div>
<!-- ADD DEVICE -->
<div id="add-device" data-uk-offcanvas="flip: true; overlay: true;">
    {% csrf_token %}
    <div class="uk-offcanvas-bar">
        <button class="uk-offcanvas-close" type="button" data-uk-close></button>
        <span class="uk-text-large">Add Device</span>
        <div id="add-device-content" class="uk-margin-top">
            <div id="add-device-notifications"></div>
            <form id="add-device-form">
                {% csrf_token %}
                <div class="uk-margin">
                    <b>Owner:</b> {{ employee.name }}
                    <br /><b>School ID:</b> {{ employee.id }}
                </div>
                <h5 class="uk-heading-divider uk-margin-top uk-text-uppercase uk-text-bold">Device Information</h5>
                <div class="uk-margin">
                    <label for="device-type" class="uk-form-label">Which device are you assigning?</label>
                    <select id="modify-assets-search" style="width: 100%">
                        <option></option>
                    </select>
                </div>
                <h5 class="uk-heading-divider uk-margin uk-text-uppercase uk-text-bold">Additional Information</h5>
                <div class="uk-margin">
                    <p class="uk-form-label" style="margin-bottom:4px">Why are you adding a device? (Quick Notes)</p>
                    <div class="uk-grid-collapse uk-child-width-1-2" data-uk-grid>
                        <div class="uk-grid-collapse uk-child-width-1-1" data-uk-grid>
                            <label class="uk-form-label"><input type="checkbox" id="device-quicknote-ndns" class="uk-checkbox" /> "New device for new employee."</label>
                            <label class="uk-form-label"><input type="checkbox" id="device-quicknote-rd" class="uk-checkbox" /> "Replacement device."</label>
                            <label class="uk-form-label"><input type="checkbox" id="device-quicknote-tld" class="uk-checkbox" /> "Temporary loaner device."</label>
                        </div>
                    </div>
                    <script>
                    $(document).on("click", "#device-quicknote-ndns", function() {
                        if ($(this).prop("checked")) {
                            $("#device-note").append("New device for new employee.");
                            $("#device-quicknote-ndns").prop("checked", true);
                        }
                    });
                    $(document).on("click", "#device-quicknote-rd", function() {
                        if ($(this).prop("checked")) {
                            $("#device-note").append("Replacement device.");
                            $("#device-quicknote-rd").prop("checked", true);
                        }
                    });
                    $(document).on("click", "#device-quicknote-tld", function() {
                        if ($(this).prop("checked")) {
                            $("#device-note").append("Temporary loaner device.");
                            $("#device-quicknote-tld").prop("checked", true);
                        }
                    });
                    </script>
                </div>
                <div class="uk-margin">
                    <label for="device-note" class="uk-form-label">Why are you adding a device?</label>
                    <textarea id="device-note" rows="3" class="uk-textarea" style="resize: none;" placeholder="Newly enrolled employee is getting a device." required></textarea>
                </div>
                <hr />
                <div class="uk-text-right">
                    <button id="add-device-form-submit" type="submit" class="uk-button uk-button-danger">Add</button>
                    <a href="#add-device" class="uk-button uk-button-default" data-uk-toggle>Cancel</a>
                </div>
            </form>
            <script>
            $(document).on("submit", "#add-device-form", function(event) {
                event.preventDefault();

                $('#add-device-form-submit').replaceWith('<div uk-spinner></div>');

                $.ajax({
                    type: "POST",
                    url: "{% url 'users:add_device_submit' %}",
                    data: {
                        csrfmiddlewaretoken: $("#add-device-form input[name=csrfmiddlewaretoken]").val(),
                        employee_id: "{{ employee.id }}",
                        device_id: $("#add-device-form #modify-assets-search").val(),
                        assign_note: $("#add-device-form #device-note").val()
                    },
                    error: function(xhr, errmsg, err) {
                        console.log(xhr.status + ': ' + xhr.responseText);
                    },
                    complete: function() {
                        window.location.reload(true);
                    }
                });
            });
            </script>
            <div class="meta-container uk-margin">
                <div class="uk-form-label uk-text-bold uk-text-uppercase">Meta information:</div>
                <div class="uk-form-controls uk-form-controls-text">
                    <b>Author:</b> {{ request.user.get_full_name }} &centerdot; <b>Timestamp:</b> {{ current_datetime|date:'F d, Y ~H:i A' }}
                </div>
            </div>
        </div>
    </div>
</div>
<!-- /ADD DEVICE -->
<!-- MODIFY DEVICE -->
<div id="modify-device" data-uk-offcanvas="flip: true; overlay: true;">
    {% csrf_token %}
    <div class="uk-offcanvas-bar">
        <button class="uk-offcanvas-close" type="button" data-uk-close></button>
        <span class="uk-text-large">Check-in Device</span>
        <div id="modify-device-content"></div>
    </div>
</div>
<!-- /MODIFY DEVICE -->
<!-- ADD CHARGER -->
<div id="add-charger" data-uk-offcanvas="flip: true; overlay: true;">
    {% csrf_token %}
    <div class="uk-offcanvas-bar">
        <button class="uk-offcanvas-close" type="button" data-uk-close></button>
        <span class="uk-text-large">Add Peripheral</span>
        <div id="add-charger-content" class="uk-margin-top">
            <div id="add-charger-notifications"></div>
            <form id="add-charger-form">
                {% csrf_token %}
                <div class="uk-margin">
                    <b>Owner:</b> {{ employee.name }}
                    <br /><b>School ID:</b> {{ employee.id }}
                </div>
                <h5 class="uk-heading-divider uk-margin-top uk-text-uppercase uk-text-bold">Add Peripheral</h5>
                <div class="uk-margin">
                    <label for="charger-type" class="uk-form-label">What type of peripheral are you assigning?</label>
                    <select id="charger-type" class="uk-select" required>
                        <option value="">--</option>
                        {% for type in charger_types %}
                        <option value="{{ type.id }}">{{ type.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="uk-margin">
                    <p class="uk-form-label" style="margin-bottom:4px">What's the condition of the peripheral, overall?</p>
                    <div class="uk-grid-small uk-grid-row-collapse" data-uk-grid>
                    {% for condition in charger_conditions %}
                        {% if condition.id != 'D' %}
                        <label class="uk-form-label"><input type="radio" name="charger-condition" class="uk-radio" value="{{ condition.id }}"{% if forloop.first %} required{% endif %} /> {{ condition.name }}</label>
                        {% endif %}
                    {% endfor %}
                    </div>
                </div>
                <h5 class="uk-heading-divider uk-margin uk-text-uppercase uk-text-bold">Additional Information</h5>
                <div class="uk-margin">
                    <p class="uk-form-label" style="margin-bottom:4px">Why are you adding the peripheral? (Quick Notes)</p>
                    <div class="uk-grid-small uk-grid-collapse uk-child-width-1-1" data-uk-grid>
                        <label class="uk-form-label"><input type="checkbox" id="charger-quicknote-cad" class="uk-checkbox" /> "Charger assigned with device."</label>
                        <label class="uk-form-label"><input type="checkbox" id="peripheral-quicknote-awc" class="uk-checkbox" /> "Assigned case with device."</label>
                    </div>
                    <script>
                    $(document).on("click", "#charger-quicknote-cad", function() {
                        if ($("#charger-quicknote-cad").prop("checked")) {
                            $("#charger-note").append("Charger assigned with device.");
                            $("#charger-quicknote-cad").prop("checked", true);
                        }
                    });
                    $(document).on("click", "#peripheral-quicknote-awc", function() {
                        if ($(this).prop("checked")) {
                            $("#charger-note").append("Assigned case with device.");
                            $("#charger-quicknote-awc").prop("checked", true);
                        }
                    });
                    </script>
                </div>
                <div class="uk-margin">
                    <label for="charger-note" class="uk-form-label">Why are you adding the peripheral?</label>
                    <textarea id="charger-note" rows="3" class="uk-textarea" style="resize: none;" placeholder="User damaged the charger cable and it needs to be replaced." required></textarea>
                </div>
                <hr />
                <div class="uk-text-right">
                    <button id="add-charger-form-submit" type="submit" class="uk-button uk-button-danger">Add</button>
                    <a href="#add-charger" class="uk-button uk-button-default" data-uk-toggle>Cancel</a>
                </div>
            </form>
            <script>
            $(document).on("submit", "#add-charger-form", function(event) {
                event.preventDefault();

                $('#add-charger-form-submit').replaceWith('<div uk-spinner></div>');

                $.ajax({
                    type: "POST",
                    url: "{% url 'users:add_charger_submit' %}",
                    data: {
                        csrfmiddlewaretoken: $("#add-charger-form input[name=csrfmiddlewaretoken]").val(),
                        employee_id: "{{ employee.id }}",
                        charger_type: $("#add-charger-form #charger-type").val(),
                        charger_condition: $("#add-charger-form input[name=charger-condition]").val(),
                        charger_note: $("#add-charger-form #charger-note").val()
                    },
                    error: function(xhr, errmsg, err) {
                        console.log(xhr.status + ': ' + xhr.responseText);
                    },
                    complete: function() {
                        window.location.reload(true);
                    }
                });
            });
            </script>
            <div class="meta-container uk-margin">
                <div class="uk-form-label uk-text-bold uk-text-uppercase">Meta information:</div>
                <div class="uk-form-controls uk-form-controls-text">
                    <b>Author:</b> {{ request.user.get_full_name }} &centerdot; <b>Timestamp:</b> {{ current_datetime|date:'F d, Y ~H:i A' }}
                </div>
            </div>
        </div>
    </div>
</div>
<!-- /ADD CHARGER -->
<!-- MODIFY CHARGER -->
<div id="modify-charger" data-uk-offcanvas="flip: true; overlay: true;">
    {% csrf_token %}
    <div class="uk-offcanvas-bar">
        <button class="uk-offcanvas-close" type="button" data-uk-close></button>
        <span class="uk-text-large">Edit Charger</span>
        <div id="modify-charger-content"></div>
    </div>
</div>
<!-- /MODIFY CHARGER -->
<!-- ADD FINE -->
<div id="fines-add" data-uk-offcanvas="flip: true; overlay: true;">
    <div class="uk-offcanvas-bar">
        <button class="uk-offcanvas-close" type="button" data-uk-close></button>
        <form id="add-fine-form" class="uk-form-vertical" method="POST">
            {% csrf_token %}
            <span class="uk-text-large">Add employee Fine</span>
            <div class="uk-alert-warning uk-text-justify" uk-alert>
                <p>This information is submitted directly to MySchoolBucks and will shortly thereafter email an invoice to all addresses on file. There is no way to reverse this unless you sign into MySchoolBucks and delete the invoice!</p>
            </div>
            <div class="uk-margin">
                <h5 class="uk-heading-divider uk-margin-top uk-text-uppercase uk-text-bold">employee Information</h5>
                <div class="uk-form-controls uk-form-controls-text">
                    {{ employee.name }} ({{ employee.id }})
                    <br />{{ employee.location }} &centerdot;
                    {% if employee.grade == 'GD' %}
                    Graduated
                    {% elif employee.grade == 'KG' %}
                    Kindergarten
                    {% elif employee.grade == '00' %}
                    No Grade
                    {% else %}
                    {{ employee.grade | ordinal }} Grade
                    {% endif %}
                </div>
            </div>
            <div class="uk-margin">
                <h5 class="uk-heading-divider uk-margin-top uk-text-uppercase uk-text-bold">Fine Information</h5>
                <div class="uk-form-controls uk-form-controls-text uk-margin-small">
                    Which device is this fine associated with (if applicable)?
                    <select id="fine-select-device" class="uk-select">
                        <option value="NA">-</option>
                        {% for device, property in assigned_devices.items %}
                        <option value="{{ device }}"{% if forloop.first %} selected{% endif %}>{{ property.model|remove_parentheses }} ({{ device }})</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="uk-form-controls uk-form-controls-text uk-margin-small">
                    What type of fine is this?
                    <select id="fine-select-finetype" class="uk-select">
                        <option value="NA">-</option>
                        {% for type in fine_types %}
                        <option value="{{ type.alias }}"{% if type.alias == 'FINE' %} selected{% endif %}>{{ type.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="uk-form-controls uk-form-controls-text uk-margin-small">
                    What is this fine regarding, specifically?
                    <select id="fine-select-finesubtype" class="uk-select" required>
                        {% for type in fine_subtypes %}
                        <option value="{{ type.alias }}"{% if forloop.first %} selected{% endif %}>{{ type.name }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            <div class="uk-margin">
                <h5 class="uk-heading-divider uk-margin-top uk-text-uppercase uk-text-bold">Additional Notes</h5>
                <div class="uk-form-controls uk-form-controls-text">
                    <textarea id="fine-select-note" rows="3" class="uk-textarea" style="resize: none;" placeholder="For internal records only: this will automatically add a note to the employee's account in SADIS, but will not appear on MySchoolBucks."></textarea>
                </div>
            </div>
            <div class="uk-margin uk-text-right">
                <button id="add-fine-submit" type="submit" class="uk-button uk-button-danger">Add Fine</button>
                <a href="#fines-add" class="uk-button uk-button-default" data-uk-toggle>Cancel</a>
            </div>
            <div class="meta-container uk-margin">
                <div class="uk-grid-small uk-flex uk-flex-middle" data-uk-grid>
                    <div class="uk-width-expand">
                        <div class="uk-form-label uk-text-bold uk-text-uppercase">Meta information:</div>
                        <div class="uk-form-controls uk-form-controls-text">
                            <b>Author:</b> {{ request.user.get_full_name }} &centerdot; <b>Timestamp:</b> {{ current_datetime|date:'F d, Y ~H:i A' }}
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>
<!-- /ADD FINE -->
<!-- Start employee Password Modal -->
<div id="change-password-modal" class="uk-flex-top" uk-modal>
    <div class="uk-modal-dialog uk-modal-body">
        <h2 class="uk-modal-title">Password Update/Change</h2>
        <form id="update-password" method="POST">
            {% csrf_token %}
            <div class="uk-margin">
                <div class="uk-form-controls">
                    <input id="updated-employee-password" type="text" class="uk-input" autofocus="autofocus" value="" placeholder="Enter a new password">
                </div>
            </div>
            <div class="uk-margin uk-text-right">
                <button type="button" class="uk-button uk-button-default uk-modal-close">Cancel</button>
                <button id="update-password-submit" type="submit" class="uk-button uk-button-primary">Save</button>
            </div>
        </form>
    </div>
</div>
<!-- End employee Password Modal -->
<script>
// On Ready
$(document).ready(function() {
    var clipboard = new ClipboardJS('.clipboard');

    $('#modify-assets-search').select2({
        placeholder: 'Search for device...',
        width: 'resolve',
        minimumInputLength: 2,
        ajax: {
            delay: 500,
            dataType: 'json',
            type: 'POST',
            data: function (params) {
                return {
                    csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
                    action: 'modify-assets-search',
                    search: params.term,
                }
            },
            processResults: function(data, params) {
                return {
                    results: $.map(data, function(item) {
                        return {
                            id: item.id,
                            text: item.text
                        }
                    })
                };
            }
        }
    });

    $(document).on("click", "#get-iiq-id", function(event) {
        event.preventDefault();

        $.ajax({
            type: "POST",
            data: {
                csrfmiddlewaretoken: "{{ csrf_token }}",
                action: "get-iiq-id-submit"
            },
            error: function(xhr, errmsg, err) {
                console.log(xhr.status + ": " + xhr.responseText);

                $("#profile-items").prepend(
                    '<div>' +
                        '<div class="uk-alert-danger" uk-alert>' +
                            '<a class="uk-alert-close" uk-close></a>' +
                            '<p>Something went wrong! Please try again and if the issue persists, please contact your technology support technician to troubleshoot the issue.</p>' +
                        '</div>' +
                    '</div>'
                );
            },
            complete: function() {
                $("#profile-data").load(location.href + " #profile-data>*", "");
            }
        });
    });

    $(document).on("submit", "#resend-confirmation-form", function(event) {
        event.preventDefault();

        $("#resend-confirmation-button").replaceWith('<div id="resend-confirmation-loading"><i class="fas fa-sync fa-spin"></i></div>');

        $.ajax({
            type: "POST",
            data: {
                csrfmiddlewaretoken: $("input[name=csrfmiddlewaretoken]").val(),
                action: "resend-registration-email",
                resend_address: $("#resend-email-address").val()
            },
            success: function(json) {
                document.getElementById("resend-confirmation-form").reset();
            },
            error: function(xhr, errmsg, err) {
                console.log(xhr.status + ": " + xhr.responseText);
            },
            complete: function() {
                $("#resend-confirmation-loading").replaceWith('<button id="resend-confirmation-button" class="uk-button uk-button-small uk-button-danger">Resend Confirmation</button>');
                $('#parent-information').load(location.href + ' #parent-information>*', '');
                $('#resend-confirmation-modal').load(location.href + ' #resend-confirmation-modal>*', '');

                UIkit.modal('#resend-confirmation-modal').hide();
            }
        });
    });

    $(document).on("submit", "#add-note-form", function(event) {
        event.preventDefault();

        $("#add-note-submit").replaceWith('<button id="add-note-submit" type="submit" class="uk-button uk-button-default uk-button-small uk-width-small" disabled><i class="fas fa-sync fa-spin"></i></button>');

        $.ajax({
            url: "{% url 'users:add_note' %}",
            data: {
                csrfmiddlewaretoken: $("#add-note-form input[name=csrfmiddlewaretoken]").val(),
                employee_id: "{{ employee.id }}",
                note_body: $("#add-note-body").val()
            },
            dataType: "json",
            error: function(xhr) {
                console.log(xhr.status + ": " + xhr.responseText);
            },
            complete: function(response_data) {
                if (response_data.response_code == 404) {
                    $("#add-note-form").prepend(
                        '<div class="uk-alert-danger" uk-alert>' +
                            '<a class="uk-alert-close" uk-close></a>' +
                            '<p>' + response_data.response_message + '</p>' +
                        '</div>'
                    );
                } else {
                    window.location.reload(true);
                }
            }
        });
    });

    // Eligibility
    $(document).on("click", "#change-ec", function(event) {
        event.preventDefault();
        var ec_id = $(this).data("id");

        $.ajax({
            type: 'POST',
            data: {
                csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
                action: 'change-employee-ec',
                role_id: ec_id
            },
            error: function(xhr, errmsg, err) {
                console.log(xhr.status + ': ' + xhr.responseText);
            },
            complete: function() {
                window.location.reload(true);
            }
        });
    });

    // Archive Data
    $(document).on("click", "#archive-data-submit", function(event) {
        event.preventDefault();

        $.ajax({
            type: 'POST',
            url: "{% url 'users:archive_dlmr_data' %}",
            data: {
                csrfmiddlewaretoken: "{{ csrf_token }}",
                employee_id: "{{ employee.id }}"
            },
            error: function(xhr, errmsg, err) {
                console.log(xhr.status + ': ' + xhr.responseText);
            },
            complete: function() {
                window.location.reload(true);
            }
        });
    });

    // Status
    $(document).on("click", "#change-status", function(event) {
        event.preventDefault();
        var status_id = $(this).data("id");

        $.ajax({
            type: 'POST',
            data: {
                csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
                action: 'change-employee-status',
                status_id: status_id
            },
            error: function(xhr, errmsg, err) {
                console.log(xhr.status + ': ' + xhr.responseText);
            },
            complete: function() {
                window.location.reload(true);
            }
        });
    });

    // Transfer
    $(document).on("click", "#profile-complete-transfer", function(event) {
        event.preventDefault();

        $('#employee-profile-action').replaceWith(
        '<button class="uk-button uk-button-default uk-button-small uk-width-small" disabled>' +
            '<i class="fas fa-sync fa-spin"></i>' +
        '</button>'
        )

        $.ajax({
            type: 'POST',
            data: {
                csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
                action: 'complete-employee-transfer'
            },
            error: function(xhr, errmsg, err) {
                console.log(xhr.status + ': ' + xhr.responseText);
            },
            complete: function() {
                window.location.reload(true);
            }
        });
    });

    // IncidentIQ
    $(document).on('submit', '#get-iiq-id-form', function(event) {
        event.preventDefault();

        $.ajax({
            type: 'POST',
            data: {
                csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
                action: 'get-iiq-id-submit'
            },
            success: function(json) {
                document.getElementById('get-iiq-id-form').reset();
            },
            error: function(xhr, errmsg, err) {
                console.log(xhr.status + ': ' + xhr.responseText);
            },
            complete: function() {
                $('#user-header').load(location.href + ' #user-header>*', '');
                $('#profile-data').load(location.href + ' #profile-data>*', '');
                $('#asset-data').load(location.href + ' #asset-data>*', '');
            }
        });
    });

    // Password
    $(document).on('submit', '#update-password', function(event) {
        event.preventDefault();

        $.ajax({
            type: 'POST',
            url: '{% url "users:update_employee_password" %}',
            data: {
                csrfmiddlewaretoken: $('#update-password input[name=csrfmiddlewaretoken]').val(),
                employee_id: '{{ employee.id }}',
                new_password: $("#updated-employee-password").val()
            },
            success: function(json) {
                window.location.reload(true);
            },
            error: function(xhr, errmsg, err) {
                console.log(xhr.status + ': ' + xhr.responseText);
            }
        });
    });

    $(document).on("click", "#profile-sync-iiq", function(event) {
        event.preventDefault();

        $('#employee-profile-action').replaceWith('<div uk-spinner></div>')

        $.ajax({
            type: 'POST',
            data: {
                csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
                action: 'sync-iiq-submit'
            },
            error: function(xhr, errmsg, err) {
                console.log(xhr.status + ': ' + xhr.responseText);
            },
            complete: function() {
                window.location.reload(true);
            }
        });
    });

    // Notes
    $(document).on("submit", "#delete-note-form", function(event) {
        event.preventDefault();

        var note_id = $(document.activeElement).prev().val()

        UIkit.modal.confirm('Are you sure you want to delete this note?').then(function() {
            $.ajax({
               type: 'POST',
               data: {
                   csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
                   action: 'delete-note-submit',
                   to_delete: note_id
               },
               success: function(json) {
                   document.getElementById('delete-note-form').reset();
               },
               error: function(xhr, errmsg, err) {
                   console.log(xhr.status + ': ' + xhr.responseText);
               },
               complete: function() {
                   $('#note-items').load(location.href + ' #note-items>*', '');
                   $('#create-invoice').load(location.href + ' #create-invoice>*', '');
                   $('#note-transactions').load(location.href + ' #note-transactions>*', '');
               }
            });

            return true
        }, function() {
            return false
        });
    });

    // Assets
    $(document).on("click", "#assets-sync-iiq", function(event) {
        event.preventDefault();

        $('#employee-assets-action').replaceWith('<div uk-spinner></div>');

        $.ajax({
            type: "POST",
            data: {
                csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
                action: 'sync-assets-submit'
            },
            error: function(xhr, errmsg, err) {
                console.log(xhr.status + ": " + xhr.responseText);
            },
            complete: function() {
                window.location.reload(true);
            }
        });
    });

    var add_assets_set = new Array();
    var remove_assets_set = new Array();

    $(document).on('click', '#modify-assets-add', function(event) {
        event.preventDefault();

        var asset_id = $('#modify-assets-search').val();
        add_assets_set.push(asset_id);

        $.ajax({
            type: 'POST',
            data: {
                csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
                action: 'get-internal-asset',
                asset_id: asset_id
            },
            success: function(json) {
                $('#modify-assets-added').append(
                '<div>' +
                    '<div class="item-container item-container-success">' +
                        '<div class="uk-flex uk-flex-middle">' +
                            '<div class="uk-padding-small uk-padding-remove-vertical">' +
                                '<i class="fas fa-laptop fa-2x"></i>' +
                            '</div>' +
                            '<div class="uk-width-expand">' +
                                '<span class="uk-text-bold">' + json.manufacturer + ' ' + json.model + '</span>' +
                                '<div class="uk-text-small">' +
                                    '<i class="fas fa-hashtag"></i>' + ' ' + json.id +
                                '</div>' +
                            '</div>' +
                        '</div>' +
                    '</div>' +
                '</div>'
                );
            },
            error: function(xhr, errmsg, err) {
                console.log(xhr.status + ': ' + xhr.responseText);
            }
        });
    });

    $(document).on('click', '#modify-assets-remove', function(event) {
        event.preventDefault();

        var asset_id = $(this).data('id');
        remove_assets_set.push(asset_id);

        $.ajax({
            type: 'POST',
            data: {
                csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
                action: 'get-internal-asset',
                asset_id: asset_id
            },
            success: function(json) {
                $('#modify-assets-added').append(
                    '<div>' +
                        '<div class="item-container item-container-danger">' +
                            '<div class="uk-flex uk-flex-middle">' +
                                '<div class="uk-padding-small uk-padding-remove-vertical">' +
                                    '<i class="fas fa-laptop fa-2x"></i>' +
                                '</div>' +
                                '<div class="uk-width-expand">' +
                                    '<span class="uk-text-bold">' + json.manufacturer + ' ' + json.model + '</span>' +
                                    '<div class="uk-text-small">' +
                                        '<i class="fas fa-hashtag"></i>' + ' ' + json.id +
                                    '</div>' +
                                '</div>' +
                            '</div>' +
                        '</div>' +
                    '</div>'
                );
            },
            error: function(xhr, errmsg, err) {
                console.log(xhr.status + ': ' + xhr.responseText);
            }
        });
    });

    $(document).on('submit', '#modify-assets-form', function(event) {
        event.preventDefault();

        $('#modify-assets-apply').replaceWith('<div uk-spinner></div>');

        $.ajax({
            type: 'POST',
            data: {
                csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
                action: 'modify-assets-submit',
                assign_assets_list: JSON.stringify(add_assets_set),
                unassign_assets_list: JSON.stringify(remove_assets_set)
            },
            error: function(xhr, errmsg, err) {
                console.log(xhr.status + ': ' + xhr.responseText);
            },
            complete: function() {
                window.location.reload(true);
            }
        });
    });

    // Fines
    $(document).on('submit', '#add-fine-form', function(event) {
        event.preventDefault();

        $('#add-fine-submit').replaceWith('<div uk-spinner></div>');

        $.ajax({
            type: 'POST',
            url: "{% url 'users:add_fine' %}",
            data: {
                csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
                employee_id: "{{ employee.id }}",
                fine_device_id: $('#fine-select-device').val(),
                fine_type_id: $('#fine-select-finetype').val(),
                fine_subtype_id: $('#fine-select-finesubtype').val(),
                fine_note: $('#fine-select-note').val()
            },
            error: function(xhr, errmsg, err) {
                console.log(xhr.status + ': ' + xhr.responseText);
            },
            complete: function() {
                window.location.reload(true);
            }
        });
    });

    // Kevin Bacon Data
    $(document).on("submit", "#update-staging-form", function(event) {
        event.preventDefault();

        var iiq_ticket_number = $("#iiq-ticket-number").val();

        $.ajax({
            type: "POST",
            data: {
                csrfmiddlewaretoken: $("input[name=csrfmiddlewaretoken]").val(),
                action: "update-staging-data",
                device_bin: $("#staging-bin").val(),
                device_bpi: $("#staging-bpi").val(),
                iiq_ticket_number: iiq_ticket_number
            },
            success: function(json) {
                $('#staging-data').prepend(
                    '<div>' +
                        '<div class="uk-alert-success" uk-alert>' +
                            '<a class="uk-alert-close" uk-close></a>' +
                            '<p>The information you entered has been successfully saved.</p>' +
                        '</div>' +
                    '</div>'
                );
            },
            error: function(xhr, errmsg, err) {
                console.log(xhr.status + ": " + xhr.responseText);
                $('#staging-data').prepend(
                    '<div>' +
                        '<div class="uk-alert-danger" uk-alert>' +
                            '<a class="uk-alert-close" uk-close></a>' +
                            '<p>Error! Something went wrong. Please try again or contact the app administrator.</p>' +
                        '</div>' +
                    '</div>'
                );
            }
        });
    });

    // -- -- DYMO Label Framework -- -- //
    var dymoLabel;
    var dymoPrintersSelect = document.getElementById('dymo-printers-select');
    var dymoPrintButton = document.getElementById('dymo-print-button');

    dymoPrintButton.disabled = true;

    function dymoUpdatePreivew() {
        if (!dymoLabel) return;

        var dymoLabelRender = dymoLabel.render();

        dymoLabelPreview.src = 'data:image/png;base64,' + dymoLabelRender;
    }

    function dymoLoadPrinters() {
        var dymoPrinters = dymo.label.framework.getPrinters();

        for (var i = 0; i < dymoPrinters.length; i++) {
            var printerName = dymoPrinters[i].name;
            var printerOption = document.createElement('option');

            printerOption.value = printerName;
            printerOption.appendChild(document.createTextNode(printerName));

            dymoPrintersSelect.appendChild(printerOption);
        }
    }

    function dymoLoadLabel() {
        if (dymoLabelSelect.value == 'small-label') {
            dymoLabelXml = '<?xml version="1.0" encoding="utf-8"?>\
<DieCutLabel Version="8.0" Units="twips" MediaType="Default">\
  <PaperOrientation>Landscape</PaperOrientation>\
  <Id>Address</Id>\
  <PaperName>30252 Address</PaperName>\
  <DrawCommands>\
    <RoundRectangle X="0" Y="0" Width="1581" Height="5040" Rx="270" Ry="270"/>\
  </DrawCommands>\
  <ObjectInfo>\
    <TextObject>\
      <Name>employeeName</Name>\
      <ForeColor Alpha="255" Red="0" Green="0" Blue="0"/>\
      <BackColor Alpha="0" Red="255" Green="255" Blue="255"/>\
      <LinkedObjectName></LinkedObjectName>\
      <Rotation>Rotation0</Rotation>\
      <IsMirrored>False</IsMirrored>\
      <IsVariable>False</IsVariable>\
      <HorizontalAlignment>Center</HorizontalAlignment>\
      <VerticalAlignment>Middle</VerticalAlignment>\
      <TextFitMode>AlwaysFit</TextFitMode>\
      <UseFullFontHeight>True</UseFullFontHeight>\
      <Verticalized>False</Verticalized>\
      <StyledText>\
        <Element>\
          <String>Matthew Short</String>\
          <Attributes>\
            <Font Family="Helvetica" Size="13" Bold="True" Italic="False" Underline="False" Strikeout="False"/>\
            <ForeColor Alpha="255" Red="0" Green="0" Blue="0"/>\
          </Attributes>\
        </Element>\
      </StyledText>\
    </TextObject>\
    <Bounds X="331.2" Y="57.59995" Width="4622.4" Height="476.6844"/>\
  </ObjectInfo>\
  <ObjectInfo>\
    <BarcodeObject>\
      <Name>employeeId</Name>\
      <ForeColor Alpha="255" Red="0" Green="0" Blue="0"/>\
      <BackColor Alpha="255" Red="255" Green="255" Blue="255"/>\
      <LinkedObjectName></LinkedObjectName>\
      <Rotation>Rotation0</Rotation>\
      <IsMirrored>False</IsMirrored>\
      <IsVariable>False</IsVariable>\
      <Text>1234567890</Text>\
      <Type>Code39</Type>\
      <Size>Medium</Size>\
      <TextPosition>Bottom</TextPosition>\
      <TextFont Family="Helvetica" Size="10" Bold="False" Italic="False" Underline="False" Strikeout="False"/>\
      <CheckSumFont Family="Helvetica" Size="10" Bold="False" Italic="False" Underline="False" Strikeout="False"/>\
      <TextEmbedding>None</TextEmbedding>\
      <ECLevel>0</ECLevel>\
      <HorizontalAlignment>Center</HorizontalAlignment>\
      <QuietZonesPadding Left="0" Right="0" Top="0" Bottom="0"/>\
    </BarcodeObject>\
    <Bounds X="331.2" Y="863.85" Width="4622.4" Height="600"/>\
  </ObjectInfo>\
  <ObjectInfo>\
    <TextObject>\
      <Name>employeeLocation</Name>\
      <ForeColor Alpha="255" Red="0" Green="0" Blue="0"/>\
      <BackColor Alpha="0" Red="255" Green="255" Blue="255"/>\
      <LinkedObjectName></LinkedObjectName>\
      <Rotation>Rotation0</Rotation>\
      <IsMirrored>False</IsMirrored>\
      <IsVariable>False</IsVariable>\
      <HorizontalAlignment>Center</HorizontalAlignment>\
      <VerticalAlignment>Middle</VerticalAlignment>\
      <TextFitMode>ShrinkToFit</TextFitMode>\
      <UseFullFontHeight>True</UseFullFontHeight>\
      <Verticalized>False</Verticalized>\
      <StyledText>\
        <Element>\
          <String>Matanzas High School</String>\
          <Attributes>\
            <Font Family="Helvetica" Size="13" Bold="False" Italic="False" Underline="False" Strikeout="False"/>\
            <ForeColor Alpha="255" Red="0" Green="0" Blue="0"/>\
          </Attributes>\
        </Element>\
      </StyledText>\
    </TextObject>\
    <Bounds X="331.2" Y="432.5999" Width="4622.4" Height="326.7188"/>\
  </ObjectInfo>\
</DieCutLabel>';
            dymoLabel = dymo.label.framework.openLabelXml(dymoLabelXml);
            dymoLabel.setObjectText('employeeName', '{{ employee.name }}')
            dymoLabel.setObjectText('employeeLocation', '{{ employee.location.name }}')
            dymoLabel.setObjectText('employeeId', '{{ employee.id }}')

            document.getElementById('dymo-label-preview').src = "{% static 'dymo/small-label-sample.png' %}";
            dymoPrintButton.disabled = false;
        } else {
            dymoLabelXml = '<?xml version="1.0" encoding="utf-8"?>\
<DieCutLabel Version="8.0" Units="twips" MediaType="Default">\
  <PaperOrientation>Landscape</PaperOrientation>\
  <Id>LargeShipping</Id>\
  <PaperName>30256 Shipping</PaperName>\
  <DrawCommands>\
    <RoundRectangle X="0" Y="0" Width="3331" Height="5715" Rx="270" Ry="270"/>\
  </DrawCommands>\
  <ObjectInfo>\
    <TextObject>\
      <Name>employeeName</Name>\
      <ForeColor Alpha="255" Red="0" Green="0" Blue="0"/>\
      <BackColor Alpha="0" Red="255" Green="255" Blue="255"/>\
      <LinkedObjectName></LinkedObjectName>\
      <Rotation>Rotation0</Rotation>\
      <IsMirrored>False</IsMirrored>\
      <IsVariable>False</IsVariable>\
      <HorizontalAlignment>Center</HorizontalAlignment>\
      <VerticalAlignment>Middle</VerticalAlignment>\
      <TextFitMode>AlwaysFit</TextFitMode>\
      <UseFullFontHeight>True</UseFullFontHeight>\
      <Verticalized>False</Verticalized>\
      <StyledText>\
        <Element>\
          <String>Matthew Short</String>\
          <Attributes>\
            <Font Family="Helvetica" Size="13" Bold="True" Italic="False" Underline="False" Strikeout="False"/>\
            <ForeColor Alpha="255" Red="0" Green="0" Blue="0"/>\
          </Attributes>\
        </Element>\
      </StyledText>\
    </TextObject>\
    <Bounds X="335.9998" Y="57.6001" Width="5337.6" Height="953.0154"/>\
  </ObjectInfo>\
  <ObjectInfo>\
    <TextObject>\
      <Name>employeeLocation</Name>\
      <ForeColor Alpha="255" Red="127" Green="134" Blue="136"/>\
      <BackColor Alpha="0" Red="255" Green="255" Blue="255"/>\
      <LinkedObjectName></LinkedObjectName>\
      <Rotation>Rotation0</Rotation>\
      <IsMirrored>False</IsMirrored>\
      <IsVariable>False</IsVariable>\
      <HorizontalAlignment>Center</HorizontalAlignment>\
      <VerticalAlignment>Middle</VerticalAlignment>\
      <TextFitMode>AlwaysFit</TextFitMode>\
      <UseFullFontHeight>True</UseFullFontHeight>\
      <Verticalized>False</Verticalized>\
      <StyledText>\
        <Element>\
          <String>Matanzas High School</String>\
          <Attributes>\
            <Font Family="Helvetica" Size="24" Bold="False" Italic="False" Underline="False" Strikeout="False"/>\
            <ForeColor Alpha="255" Red="127" Green="134" Blue="136"/>\
          </Attributes>\
        </Element>\
      </StyledText>\
    </TextObject>\
    <Bounds X="335.9998" Y="891.5625" Width="5337.6" Height="600"/>\
  </ObjectInfo>\
  <ObjectInfo>\
    <BarcodeObject>\
      <Name>employeeId</Name>\
      <ForeColor Alpha="255" Red="0" Green="0" Blue="0"/>\
      <BackColor Alpha="255" Red="255" Green="255" Blue="255"/>\
      <LinkedObjectName></LinkedObjectName>\
      <Rotation>Rotation0</Rotation>\
      <IsMirrored>False</IsMirrored>\
      <IsVariable>False</IsVariable>\
      <Text>1234567890</Text>\
      <Type>Code39</Type>\
      <Size>Medium</Size>\
      <TextPosition>Bottom</TextPosition>\
      <TextFont Family="Helvetica" Size="14" Bold="False" Italic="False" Underline="False" Strikeout="False"/>\
      <CheckSumFont Family="Helvetica" Size="10" Bold="False" Italic="False" Underline="False" Strikeout="False"/>\
      <TextEmbedding>None</TextEmbedding>\
      <ECLevel>0</ECLevel>\
      <HorizontalAlignment>Center</HorizontalAlignment>\
      <QuietZonesPadding Left="0" Right="0" Top="0" Bottom="0"/>\
    </BarcodeObject>\
    <Bounds X="335.9998" Y="1523.125" Width="5337.6" Height="965.625"/>\
  </ObjectInfo>\
  <ObjectInfo>\
    <DateTimeObject>\
      <Name>DATE-TIME</Name>\
      <ForeColor Alpha="255" Red="0" Green="0" Blue="0"/>\
      <BackColor Alpha="0" Red="255" Green="255" Blue="255"/>\
      <LinkedObjectName></LinkedObjectName>\
      <Rotation>Rotation0</Rotation>\
      <IsMirrored>False</IsMirrored>\
      <IsVariable>False</IsVariable>\
      <HorizontalAlignment>Center</HorizontalAlignment>\
      <VerticalAlignment>Middle</VerticalAlignment>\
      <TextFitMode>ShrinkToFit</TextFitMode>\
      <UseFullFontHeight>True</UseFullFontHeight>\
      <Verticalized>False</Verticalized>\
      <DateTimeFormat>WeekdayLongMonthDayLongYear</DateTimeFormat>\
      <Font Family="Helvetica" Size="13" Bold="False" Italic="False" Underline="False" Strikeout="False"/>\
      <PreText></PreText>\
      <PostText></PostText>\
      <IncludeTime>False</IncludeTime>\
      <Use24HourFormat>False</Use24HourFormat>\
    </DateTimeObject>\
    <Bounds X="335.9998" Y="2592.022" Width="5337.6" Height="600"/>\
  </ObjectInfo>\
</DieCutLabel>';
            dymoLabel = dymo.label.framework.openLabelXml(dymoLabelXml);
            dymoLabel.setObjectText('employeeName', '{{ employee.name }}')
            dymoLabel.setObjectText('employeeLocation', '{{ employee.location.name }}')
            dymoLabel.setObjectText('employeeId', '{{ employee.id }}')

            document.getElementById('dymo-label-preview').src = "{% static 'dymo/large-label-sample.png' %}";
            dymoPrintButton.disabled = false;
        }
    }

    dymoLoadPrinters();

    var dymoLabelSelect = document.getElementById('dymo-label-select');
    dymoLoadLabel();

    var dymoLabelPreview = document.getElementById('dymo-label-preview');
    dymoUpdatePreivew();

    dymoLabelSelect.addEventListener('change', function() {
        dymoLoadLabel();
        dymoUpdatePreivew();
    });

    dymoPrintButton.addEventListener('click', function() {
        try {
            $.ajax({
                type: "POST",
                url: "{% url 'users:add_id_log' %}",
                data: {
                    csrfmiddlewaretoken: $("input[name=csrfmiddlewaretoken]").val(),
                    employee_id: '{{ employee.id }}',
                    label_size: dymoLabelSelect.value
                },
                success: function(json) {
                    dymoLabel.print(dymoPrintersSelect.value);
                    console.log(json);
                },
                error: function(xhr, errmsg, err) {
                    console.log(xhr.status + ": " + xhr.responseText);
                },
                complete: function() {
                    window.location.reload(true);
                }
            });
        } catch (printError) {
            alert(printError.message || printError);
        }
    });
    // -- -- DYMO Label Framework -- -- //
});
</script>
{% endblock %}
