{% extends 'base-fa6.html' %}
{% load asset_tags humanize numbers qurl static %}
{% block title %}User Detail | {{ student.id }}{% endblock %}
{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/select2.css' %}" />
<style>
@media print {
    .student-tempid-dymo, #student-infolabel-print {
        width: 101.6mm;
        height: 50.925mm;
        padding: 0.5mm;
    }
    .student-tempid-dymo img {
        image-rendering: pixelated;
    }
}
</style>
{% endblock %}
{% block extra_js %}
<script src="{% static 'js/clipboard.js' %}"></script>
<script src="{% static 'js/select2.js' %}"></script>
<script src="{% static 'js/barcode.code39.min.js' %}"></script>
{% endblock %}
{% block content %}
<div class="uk-section uk-section-muted uk-padding uk-padding-remove-top">
    <div class="uk-grid-small uk-child-width-1-1" data-uk-grid>
        <!-- SEARCH -->
        <div>
            <div class="uk-card uk-card-default uk-card-small">
                <div class="uk-card-body">
                    <form class="uk-grid-collapse uk-flex uk-flex-center" action="{% url 'users:home' %}" method="POST" data-uk-grid>
                        {% csrf_token %}
                        <div class="uk-button-group uk-width-1-1">
                            <input class="uk-input uk-form-small uk-width-1-1" type="search" name="search" value="{{ request.GET.search }}" placeholder="Search by student school ID, name, or username" style="border-right:0">
                            <button class="uk-button uk-button-primary uk-button-small">Search</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <!-- /SEARCH -->
        <!-- STUDENT HEADER -->
        <div>
            <div class="uk-grid-small uk-child-width-1-1" data-uk-grid>
                <div class="uk-card uk-card-small uk-margin-small">
                    <div class="uk-card-body">
                        <div id="user-header" class="uk-grid-small uk-flex uk-flex-middle" data-uk-grid>
                            <div class="uk-width-auto">
                                <i class="fas fa-user fa-3x"></i>
                            </div>
                            <div class="uk-width-expand">
                                <div class="uk-card-title">
                                    <span class="clipboard" tabindex="-1" data-clipboard-action="copy" data-clipboard-text="{{ student.name }}">{{ student.name }}</span>
                                    {% if student.iiq_id %}
                                    <a href="https://flaglerschools.incidentiq.com/agent/users/{{ student.iiq_id }}" target="_blank" class="uk-badge uk-padding-small uk-padding-remove-vertical">{{ student.username }}<i class="fas fa-external-link-alt" style="font-size:80%;margin-left:5px"></i></a>
                                    {% else %}
                                    <span class="uk-badge uk-padding-small uk-padding-remove-vertical">{{ student.username }}</span>
                                    {% endif %}
                                    {% if is_admin %}
                                    <a class="uk-badge uk-badge-success uk-padding-small uk-padding-remove-vertical uk-link-reset" data-uk-tooltip="{{ student.get_role_name }}">
                                        {% if student.get_role_id == 'OTO' %}1:1{% else %}{{ student.get_role_id }}{% endif %}<i class="fas fa-caret-down" style="margin-left: 5px"></i>
                                    </a>
                                    <div data-uk-dropdown="mode: click; pos: bottom-justify; offset: 5; animation: uk-animation-slide-top-small; duration: 200">
                                        <ul class="uk-dropdown-nav" data-uk-nav>
                                            <li class="uk-nav-header" style="padding-top: 0">Change EC</li>
                                            <li class="uk-nav-divider"></li>
                                            {% for role in roles %}
                                            {% if role.id != student.role.id %}
                                            <li><a id="change-ec" data-id="{{ role.id }}" style="padding: 1px{% if forloop.last %}; padding-bottom: 5px{% endif %}">{{ role.name }}</a></li>
                                            {% endif %}
                                            {% endfor %}
                                        </ul>
                                    </div>
                                    {% else %}
                                    <span class="uk-badge uk-badge-success uk-padding-small uk-padding-remove-vertical">
                                        {% if student.get_role_id == 'OTO' %}1:1{% else %}{{ student.get_role_id }}{% endif %}
                                    </span>
                                    {% endif %}
                                    {% if is_super_admin %}
                                    <a class="uk-badge{% if student.foreign_status.id == 'IT' %} uk-badge-warning{% else %} uk-badge-white{% endif %} uk-padding-small uk-padding-remove-vertical" data-uk-tooltip="{{ student.foreign_status }}">
                                        {{ student.foreign_status.id }}<i class="fas fa-caret-down" style="margin-left:5px"></i>
                                    </a>
                                    <div data-uk-dropdown="mode: click; pos: bottom-justify; offset: 5; animation: uk-animation-slide-top-small; duration: 200">
                                        <ul class="uk-dropdown-nav" data-uk-nav>
                                            <li class="uk-nav-header" style="padding-top: 0">Change Status</li>
                                            <li class="uk-nav-divider"></li>
                                            {% for status in foreign_statuses %}
                                            {% if status.id != student.foreign_status.id %}
                                            <li>
                                                <a id="change-status" data-id="{{ status.id }}" style="padding: 1px{% if forloop.last %}; padding-bottom: 5px{% endif %}">{{ status.name }}</a>
                                            </li>
                                            {% endif %}
                                            {% endfor %}
                                        </ul>
                                    </div>
                                    {% else %}
                                    <span class="uk-badge{% if student.foreign_status.id == 'IT' %} uk-badge-warning{% else %} uk-badge-white{% endif %} uk-padding-small uk-padding-remove-vertical" data-uk-tooltip="{{ student.foreign_status }}">
                                        {{ student.foreign_status.id }}
                                    </span>
                                    {% endif %}
                                </div>
                                <div class="uk-grid-small uk-flex uk-flex-middle uk-text-meta" data-uk-grid>
                                    <div>
                                        <span class="clipboard" tabindex="-1" data-clipboard-action="copy" data-clipboard-text="{{ student.id }}" >
                                            <i class="fas fa-hashtag"></i> {{ student.id }}
                                        </span>
                                    </div>
                                    <div>
                                        <i class="far fa-calendar"></i> {{ student.sadis_updated|date:'F d, Y' }}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- /STUDENT HEADER -->
        <!-- STUDENT INFORMATION -->
        <div>
            <div class="uk-grid-small uk-child-width-1-1 uk-child-width-1-2@m" data-uk-grid>
                <div>
                    <div class="uk-card uk-card-default uk-card-small">
                        <div class="uk-card-header">
                            <div class="uk-grid-small uk-flex uk-flex-middle" data-uk-grid>
                                <div class="uk-width-expand">
                                    <span class="uk-text-large">
                                        {% if student.type == "F" %}Staff{% else %}Student{% endif %} Profile
                                    </span>
                                </div>
                                {% if student.type == "F" %}
                                <div class="uk-width-auto">
                                    Contact Info:
                                    <i class="far fa-times-circle uk-text-danger"></i>
                                </div>
                                <div class="uk-width-auto">
                                    Loan Form Activity:
                                    <i class="far fa-times-circle uk-text-danger"></i>
                                </div>
                                {% else %}
                                <div class="uk-width-auto">
                                    Registration:
                                    {% if ddata and ddata_date %}
                                    <!-- <a class="{% if ddata_date == '20-21' %}uk-text-warning{% elif ddata_date == '21-22' %}uk-text-success{% endif %}" data-uk-toggle="target: #dlm-details">{{ ddata_date }}</a>                                    {% else %} -->
                                    <a class="{% if ddata_date == '22-23' %}uk-text-warning{% elif ddata_date == '23-24' %}uk-text-success{% endif %}" data-uk-toggle="target: #dlm-details">{{ ddata_date }}</a>
                                    {% else %}
                                    <i class="far fa-times-circle uk-text-danger"></i>
                                    {% endif %}
                                </div>
                                <div class="uk-width-auto">
                                    Payment:
                                    {% if ddata.payment_complete and ddata_date %}
                                    <a data-uk-toggle="target: #dlm-details"><i class="far fa-check-circle uk-text-success"></i></a>
                                    {% else %}
                                    <i class="far fa-times-circle uk-text-danger"></i>
                                    {% endif %}
                                </div>
                                {% endif %}
                                <div class="uk-width-auto">
                                    <a id="student-profile-action" class="uk-button uk-button-default uk-button-small uk-width-small">
                                        Action<i class="fas fa-angle-down" style="margin-left:5px"></i>
                                    </a>
                                    <div class="uk-text-left uk-dropdown-close" data-uk-dropdown="mode: click; pos: bottom-right; offset: 2; animation: uk-animation-slide-top-small; duration: 200">
                                        <ul id="student-dropdown" class="student-dropdown uk-dropdown-nav" data-uk-nav>
                                            <li>
                                                {% if student.iiq_id and student.foreign_status_id != 'IT' %}
                                                <a id="profile-sync-iiq" class="uk-text-success"><i class="fas fa-cloud-download-alt fa-fw uk-margin-small-right"></i>Update Profile</a>
                                                {% else %}
                                                <span class="uk-text-muted"><i class="fa-light fa-cloud-download-alt fa-fw uk-margin-small-right"></i>Pull Profile</span>
                                                {% endif %}
                                            </li>
                                            {% if student.foreign_status_id == 'IT' and is_admin %}
                                            <li>
                                                {% if student.iiq_id %}
                                                <a id="profile-complete-transfer" class="uk-text-warning"><i class="fa-light fa-dolly fa-fw uk-margin-small-right"></i>Complete Transfer</a>
                                                {% else %}
                                                <span class="uk-text-muted"><i class="fa-light fa-dolly fa-fw uk-margin-small-right"></i>Complete Transfer</span>
                                                {% endif %}
                                            </li>
                                            {% endif %}
                                            {% if is_superuser %}
                                            <li>
                                                <a id="profile-edit" class="uk-text-primary"><i class="fa-light fa-pen-to-square fa-fw uk-margin-small-right"></i>Edit Profile</a>
                                            </li>
                                            {% endif %}
                                            <li>
                                                <a id="student-note-transactions" class="uk-text-secondary" data-uk-toggle="#note-transactions"><i class="fas fa-history fa-fw uk-margin-small-right"></i>Note History</a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="uk-card-body">
                            <div id="profile-data">
                                <table>
                                    <tbody>
                                        <tr>
                                            <td class="uk-text-bold">Name:</td>
                                            <td class="uk-visible-toggle uk-flex uk-flex-middle" tabindex="-1">
                                                <span class="clipboard" uk-tooltip="Click2Copy" data-clipboard-action="copy" data-clipboard-text="{{ student.name }}">{{ student.name }}</span>
                                                <div class="uk-hidden-hover uk-display-inline uk-margin-small-left">
                                                    <button class="clipboard uk-button uk-button-default uk-button-small uk-border-rounded" style="font-size:75%;padding:0 8px;line-height:18px" data-clipboard-action="copy" data-clipboard-text="{{ student.username }}">
                                                        <i class="fa-light fa-clipboard"></i> Copy Username
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="uk-text-bold">Location:</td>
                                            <td>{{ student.location.name }}</td>
                                        </tr>
                                        <tr>
                                            <td class="uk-text-bold">Email:</td>
                                            <td>
                                                <span class="clipboard" uk-tooltip="Click2Copy" data-clipboard-action="copy" data-clipboard-text="{{ student.username }}{% if student.type == 'F' %}@flaglerschools.com{% else %}@flaglercps.org{% endif %}">
                                                    {{ student.username }}{% if student.type == "F" %}@flaglerschools.com{% else %}@flaglercps.org{% endif %}
                                                </span>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="uk-text-bold">{% if student.type == "F" %}Employee{% else %}School{% endif %} ID:</td>
                                            <td class="uk-visible-toggle uk-flex uk-flex-middle" tabindex="-1">
                                                <span class="clipboard" uk-tooltip="Click2Copy" data-clipboard-action="copy" data-clipboard-text="{{ student.id }}">{{ student.id }}</span>
                                                <div class="uk-hidden-hover uk-display-inline uk-margin-small-left">
                                                    <button type="button" class="clipboard uk-button uk-button-default uk-button-small uk-border-rounded" style="font-size:75%;padding:0 8px;line-height:18px" uk-toggle="target: #student-tempid">
                                                        <i class="fa-light fa-barcode "></i> Temp ID
                                                    </button>
                                                    <button type="button" class="clipboard uk-button uk-button-default uk-button-small uk-border-rounded" style="font-size:75%;padding:0 8px;line-height:18px" uk-toggle="target: #student-infolabel">
                                                        <i class="fa-light fa-barcode "></i> Info Label
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                        {% if student.type == "S" %}
                                        <tr>
                                            <td class="uk-text-bold" uk-toggle="target: #change-password-modal"><span data-uk-tooltip="Click2Change">Password:</span></td>
                                            <td>
                                                <span class="clipboard" uk-tooltip="Click2Copy" data-clipboard-action="copy" data-clipboard-text="{{ student.password }}">{{ student.password }}</span>
                                            </td>
                                        </tr>
                                        {% endif %}
                                        {% if student.type == "F" %}
                                        <tr>
                                            <td class="uk-text-bold">Extension:</td>
                                            <td>None</td>
                                        </tr>
                                        <tr>
                                            <td class="uk-text-bold">Hire Date:</td>
                                            <td>None</td>
                                        </tr>
                                        <tr>
                                            <td class="uk-text-bold">Start Date:</td>
                                            <td>None</td>
                                        </tr>
                                        <tr>
                                            <td class="uk-text-bold">Final Date:</td>
                                            <td>None</td>
                                        </tr>
                                        <tr>
                                            <td class="uk-text-bold">Loan Type:</td>
                                            <td>None</td>
                                        </tr>
                                        {% else %}
                                        <tr>
                                            <td class="uk-text-bold">Grade:</td>
                                            <td>{{ student.get_grade_full }}</td>
                                        </tr>
                                        <tr>
                                            <td class="uk-text-bold">Eligibility:</td>
                                            <td>{{ student.role }}</td>
                                        </tr>
                                        <tr>
                                            <td class="uk-text-bold">Birthdate</td>
                                            <td>{{ student.birthdate }}</td>
                                        </tr>
                                        {% endif %}
                                        <tr>
                                            <td class="uk-text-bold">Active:</td>
                                            <td>{{ student.get_status }}</td>
                                        </tr>
                                        <tr>
                                            <td class="uk-text-bold">Status:</td>
                                            <td>
                                                {{ student.foreign_status }}
                                                {% if student.foreign_status_id == 'IT' %}
                                                ({{ transfer_record.transfer_to.name }})
                                                {% endif %}
                                            </td>
                                        </tr>
                                        {% if student.foreign_status_id == 'SP' %}
                                        <tr>
                                            <td class="uk-text-bold">Program:</td>
                                            <td>
                                                {% if summer_program_record %}
                                                {{ summer_program_record.program.id }}
                                                {% else %}
                                                Unknown
                                                {% endif %}
                                            </td>
                                        </tr>
                                        {% endif %}
                                        <tr>
                                            <td class="uk-text-bold">IIQ ID:</td>
                                            <td>
                                                {% if student.iiq_id %}
                                                {{ student.iiq_id }}
                                                {% else %}
                                                <a id="get-iiq-id" class="uk-text-danger">Get IIQ UUID</a>
                                                {% endif %}
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div id="note-items" class="uk-margin-top">
                                {% for note in notes %}
                                <div class="uk-grid-small uk-flex uk-flex-middle uk-margin" data-uk-grid>
                                    {% if is_admin %}
                                    <div class="uk-width-auto">
                                        <form id="delete-note-form" method="POST">
                                            <input type="hidden" value="{{ note.id }}" />
                                            <button type="submit" class="uk-icon-button uk-button-danger" data-uk-tooltip="Delete Note"><i class="fas fa-times"></i></button>
                                        </form>
                                    </div>
                                    {% endif %}
                                    <div class="uk-width-expand">
                                        {{ note.body }}
                                        <div class="uk-text-meta">
                                            Created by {{ note.author.first_name }} {{ note.author.last_name }} on {{ note.created|date:'F d, Y' }} at {{ note.created|date:'g:i A' }}
                                            {% if note.created|date:'g:i' != note.updated|date:'g:i' %}
                                            <br />Edited on {{ note.created|date:'F d, Y' }} at {{ note.updated|date:'g:i A' }}
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                                {% empty %}
                                <div class="uk-margin">
                                    There are currently no notes on file.
                                </div>
                                {% endfor %}
                                <form id="add-note-form" method="POST">
                                    {% csrf_token %}
                                    <textarea id="add-note-body" rows="3" class="uk-textarea" style="resize: none" required></textarea>
                                    <div class="uk-margin-small-top uk-text-right">
                                        <button id="add-note-submit" type="submit" class="uk-button uk-button-danger uk-button-small uk-width-small">Add Note</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                        <div id="note-transactions" class="uk-modal-full" data-uk-modal>
                            <div class="uk-modal-dialog" data-uk-height-viewport>
                                <button type="button" class="uk-modal-close-full uk-close-large" data-uk-close></button>
                                <div class="uk-modal-header">
                                    <h2 class="uk-modal-title">Note History</h2>
                                </div>
                                <div class="uk-modal-body uk-padding-remove">
                                    <table class="uk-table uk-table-small uk-table-middle uk-table-divider uk-margin-remove">
                                        <thead>
                                            <th style="width: 75px">Type</th>
                                            <th style="width: 150px">User</th>
                                            <th style="width: 150px">Date</th>
                                            <th>Note</th>
                                        </thead>
                                        <tbody>
                                            {% for record in historical_notes %}
                                            <tr>
                                                <td class="uk-text-center" style="padding-left: 15px">
                                                    {% if record.history_type == '+' %}
                                                    <span class="uk-label uk-label-success uk-width-1-1">ADD</span>
                                                    {% elif record.history_type == '-' %}
                                                    <span class="uk-label uk-label-danger uk-width-1-1">DELETE</span>
                                                    {% elif record.history_type == '~' %}
                                                    <span class="uk-label uk-width-1-1">CHANGE</span>
                                                    {% endif %}
                                                </td>
                                                <td>
                                                    {% if record.history_user %}
                                                    {{ record.history_user.username }}
                                                    {% else %}
                                                    System Admin
                                                    {% endif %}
                                                </td>
                                                <td>{{ record.history_date|date:'m-d-Y' }} <span class="uk-text-meta">{{ record.history_date|date:'h:i A' }}</span></td>
                                                <td style="padding-right: 15px">{{ record.body }}</td>
                                            </tr>
                                            {% empty %}
                                            <tr>
                                                <td colspan="4" class="uk-text-center">No records to display.</td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% if cdata %}
                    <div class="uk-card uk-card-default uk-card-small" style="margin-top:15px">
                        <div class="uk-card-header">
                            <div class="uk-grid-small uk-flex uk-flex-middle" data-uk-grid>
                                <div class="uk-width-expand">
                                    <span class="uk-text-large">Collection Data</span>
                                </div>
                                <div class="uk-width-auto uk-text-bold uk-text-right">
                                    {{ cdata.created|date:'M jS, Y' }}
                                    <br /><span class="uk-text-meta" style="font-weight:400">{{ cdata.author.get_full_name }}</span>
                                </div>
                            </div>
                        </div>
                        <div class="uk-card-body">
                            <div class="uk-grid-small uk-child-width-1-2" data-uk-grid>
                                <div>
                                    <div class="uk-margin-small">
                                        <b>BPI:</b> <a href="{% url 'assets:detail' cdata.device.id %}" target="_blank">{{ cdata.device.id }}</a>
                                        <br /><b>Bin:</b> {{ cdata.device_bin }}
                                    </div>
                                    <div class="uk-margin-small">
                                        <b>{{ cdata.get_device_return_type_display }}</b>
                                        {% if cdata.device_damage_present %}
                                        <br />Damaged: ...
                                        {% else %}
                                        <br />No Damage
                                        {% endif %}
                                    </div>
                                    <div class="uk-margin-small">
                                        <b>{{ cdata.get_charger_return_type_display }}</b>
                                        {% if cdata.charger_return_type == 'CR' %}
                                        ...
                                        {% endif %}
                                    </div>
                                </div>
                                <div>
                                    <div class="uk-margin-small">
                                        <b>Next School:</b> {{ cdata.student_next_location }}
                                        <br /><b>Next Grade:</b> {{ cdata.student_next_grade|ordinal }}
                                    </div>
                                    <div class="uk-margin-small">
                                        {{ cdata.parent_name }}
                                        <br />{{ cdata.parent_address }}
                                        <br />{{ cdata.parent_phone }}
                                        <br />{{ cdata.parent_email }}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                </div>
                <div>
                    <div class="uk-grid-small uk-child-width-1-1" data-uk-grid>
                        <div>
                            <div id="asset-data" class="uk-card uk-card-default uk-card-small">
                                <div class="uk-card-header">
                                    <div class="uk-grid-small uk-flex uk-flex-middle" data-uk-grid>
                                        <div class="uk-width-expand">
                                            <span class="uk-text-large">Assets</span>
                                        </div>
                                        <div class="uk-width-auto">
                                            <a id="student-assets-action" class="uk-button uk-button-default uk-button-small uk-width-small">
                                                Action<i class="fas fa-angle-down" style="margin-left:5px"></i>
                                            </a>
                                            <div class="uk-text-left uk-dropdown-close" uk-dropdown="mode: click; pos: bottom-right; offset: 2; animation: uk-animation-slide-top-small; duration: 200">
                                                <ul class="student-dropdown uk-dropdown-nav" data-uk-nav>
                                                    <li>
                                                        {% if student.iiq_id %}
                                                        <a id="assets-sync-iiq" class="uk-text-success"><i class="fas fa-cloud-download-alt fa-fw uk-margin-small-right"></i>Pull Assets (IIQ)</a>
                                                        {% else %}
                                                        <span class="uk-text-muted"><i class="fas fa-cloud-download-alt fa-fw uk-margin-small-right"></i>Pull Assets (IIQ)</span>
                                                        {% endif %}
                                                    </li>
                                                    <li>
                                                        <i class="fas fa-history fa-fw uk-margin-small-right"></i>Asset History
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="uk-card-body">
                                    <div class="uk-grid-small uk-child-width-1-1" data-uk-grid>
                                        <div>
                                            <div class="uk-grid-collapse uk-heading-divider" style="padding-bottom:4px" data-uk-grid>
                                                <div class="uk-text-bold uk-width-expand">
                                                    Devices
                                                </div>
                                                <div class="uk-width-auto uk-margin-small-right uk-flex uk-flex-middle">
                                                    <a data-uk-toggle="#add-device"><i class="fas fa-plus" style="padding-right:3px;"></i>Add</a>
                                                </div>
                                            </div>
                                            {% for device, property in assigned_devices.items %}
                                            <div class="item-container uk-position-relative uk-link-reset uk-margin-small">
                                                <div class="uk-flex uk-flex-middle">
                                                    <div style="padding-left:5px;padding-right:10px">
                                                        {% if property.manufacturer == "Apple" %}
                                                        <img src="{% static 'img/devices/manufacturer_apple.png' %}" alt="Error" class="uk-border-circle" style="width:48px" />
                                                        {% elif property.manufacturer == "HP" %}
                                                        <img src="{% static 'img/devices/manufacturer_hp.png' %}" alt="Error" class="uk-border-circle" style="width:48px" />
                                                        {% elif property.manufacturer == "Motorola" %}
                                                        <img src="{% static 'img/devices/manufacturer_moto.png' %}" alt="Error" class="uk-border-circle" style="width:48px" />
                                                        {% elif property.manufacturer == "Sprint" %}
                                                        <img src="{% static 'img/devices/manufacturer_sprint.png' %}" alt="Error" class="uk-border-circle" style="width:48px" />
                                                        {% elif property.manufacturer == "T-Mobile" %}
                                                        <img src="{% static 'img/devices/manufacturer_tmobile.png' %}" alt="Error" class="uk-border-circle" style="width:48px" />
                                                        {% elif property.manufacturer == "Verizon" %}
                                                        <img src="{% static 'img/devices/manufacturer_verizon.png' %}" alt="Error" class="uk-border-circle" style="width:48px" />
                                                        {% else %}
                                                        <i class="fas fa-laptop fa-2x"></i>
                                                        {% endif %}
                                                    </div>
                                                    <div class="uk-width-expand">
                                                        <span class="uk-text-bold">{{ property.model }}</span>
                                                        <div class="uk-text-small">
                                                            <i class="fas fa-hashtag"></i> {{ device }}
                                                            <div class="uk-text-meta uk-grid-small" data-uk-grid>
                                                                {% if property.roles %}
                                                                <div>
                                                                    <span data-uk-tooltip="Device Roles"><i class="fas fa-fw fa-tag fa-flip-horizontal"></i> {{ property.roles|join:', ' }}</span>
                                                                </div>
                                                                {% endif %}
                                                                {% if property.assigned != None %}
                                                                <div>
                                                                    <span data-uk-tooltip="Assigned Date"><i class="far fa-fw fa-calendar-plus"></i> {{ property.assigned|date:'m-d-Y' }}</span>
                                                                    <span class="uk-margin-small-left" data-uk-tooltip="Assigner">
                                                                        <i class="fas fa-fw fa-user"></i>
                                                                        {% if property.assigned_author != None or property.assigned_author != 'None' or property.assigned_author != '' %}
                                                                        {{ property.assigned_author }}
                                                                        {% else %}
                                                                        sysadmin
                                                                        {% endif %}
                                                                    </span>
                                                                </div>
                                                                {% endif %}
                                                                {% if property.expiration and student.type != 'F' %}
                                                                <div>
                                                                    <span class="uk-text-meta" data-uk-tooltip="Expiration Date">
                                                                        {% if summer_program_record %}
                                                                        <i class="fas fa-fw fa-clock"></i> {{ summer_program_record.program.expiration|date:'m-d-Y' }}
                                                                        {% else %}
                                                                        <i class="fas fa-fw fa-clock"></i> {{ property.expiration|date:'m-d-Y' }}
                                                                        {% endif %}
                                                                    </span>
                                                                </div>
                                                                {% endif %}
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="uk-flex uk-flex-middle">
                                                        <div>
                                                            <a href="{% url 'assets:detail' device %}" data-uk-tooltip="View Device">
                                                                <i class="fas fa-fw fa-file-alt uk-text-primary"></i>
                                                            </a>
                                                        </div>
                                                        <div>
                                                            <a class="checkin-device-button" data-deviceid="{{ device }}" data-uk-tooltip="Check-in Device">
                                                                <i class="fas fa-fw fa-inbox-in uk-text-danger"></i>
                                                            </a>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            {% empty %}
                                            <div class="uk-margin-small">
                                                No devices are currently assigned to this user.
                                            </div>
                                            {% endfor %}
                                            <script>
                                            $(document).ready(function() {
                                                $(".checkin-device-button").each(function() {
                                                    var $this = $(this);

                                                    $this.on("click", function(event) {
                                                        event.preventDefault();

                                                        $.ajax({
                                                            url: "{% url 'users:get_device' %}",
                                                            type: "POST",
                                                            data: {
                                                                csrfmiddlewaretoken: $("#modify-device input[name=csrfmiddlewaretoken]").val(),
                                                                device_id: $this.data("deviceid"),
                                                                user_email: "{{ student_email }}"
                                                            },
                                                            success: function(response) {
                                                                openOffcanvas(response);
                                                            },
                                                            error: function(xhr) {
                                                                console.log(xhr.status + ": " + xhr.responseText);
                                                            }
                                                        });

                                                        function openOffcanvas(data) {
                                                            $("#modify-device-content").replaceWith(data);
                                                            UIkit.offcanvas("#modify-device").show();
                                                        }
                                                    });
                                                });
                                            });
                                            </script>
                                        </div>
                                        <div>
                                            <div class="uk-grid-collapse uk-heading-divider" style="padding-bottom:4px" data-uk-grid>
                                                <div class="uk-text-bold uk-width-expand">
                                                    Chargers
                                                </div>
                                                <div class="uk-width-auto uk-margin-small-right uk-flex uk-flex-middle">
                                                    <a data-uk-toggle="target: #add-charger"><i class="fas fa-plus" style="padding-right:3px;"></i>Add</a>
                                                </div>
                                            </div>
                                            {% for charger, property in assigned_chargers.items %}
                                            <div class="item-container uk-margin-small uk-position-relative">
                                                <div class="uk-flex uk-flex-middle">
                                                    <div style="padding-left:5px;padding-right:10px">
                                                        <i class="fas fa-fw fa-2x fa-battery-bolt"></i>
                                                    </div>
                                                    <div class="uk-width-expand">
                                                        <div class="uk-grid-small uk-flex uk-flex-middle" data-uk-grid>
                                                            <div>
                                                                <span class="uk-text-bold">{{ property.name }}</span>
                                                            </div>
                                                            {% if not 'MagSafe' in property.name %}
                                                            <div>
                                                                {% if property.adapter %}
                                                                <span class="uk-text-success uk-text-bold" data-uk-tooltip="Charging Brick"><i class="fas fa-fw fa-plug"></i></span>
                                                                {% else %}
                                                                <span class="uk-text-danger uk-text-bold" data-uk-tooltip="Charging Brick"><i class="fas fa-fw fa-plug"></i></span>
                                                                {% endif %}
                                                                {% if property.cord %}
                                                                <span class="uk-text-success uk-text-bold" data-uk-tooltip="Charging Cord"><i class="fab fa-fw fa-usb"></i></span>
                                                                {% else %}
                                                                <span class="uk-text-danger uk-text-bold" data-uk-tooltip="Charging Cord"><i class="fab fa-fw fa-usb"></i></span>
                                                                {% endif %}
                                                                </div>
                                                            {% endif %}
                                                        </div>
                                                        <div class="uk-text-small">
                                                            <div class="uk-text-meta uk-grid-small" data-uk-grid>
                                                                {% if property.assigned != None %}
                                                                <div>
                                                                    <span data-uk-tooltip="Assigned Date"><i class="far fa-fw fa-calendar-plus"></i> {{ property.assigned|date:'m-d-Y' }}</span>
                                                                </div>
                                                                <div>
                                                                    <span data-uk-tooltip="Assigner">
                                                                        <i class="fas fa-fw fa-user"></i>
                                                                        {% if property.assigned_author != None %}
                                                                        {{ property.assigned_author }}
                                                                        {% else %}
                                                                        sysadmin
                                                                        {% endif %}
                                                                    </span>
                                                                </div>
                                                                {% endif %}
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="uk-flex uk-flex-middle">
                                                        <div>
                                                            <a class="modify-charger-button" data-chargerid="{{ charger }}" data-uk-tooltip="Edit Charger">
                                                                <i class="fas fa-fw fa-edit uk-text-danger"></i>
                                                            </a>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            {% empty %}
                                            <div class="uk-margin-small">
                                                No chargers are currently assigned to this user.
                                            </div>
                                            {% endfor %}
                                            <script>
                                            $(document).ready(function() {
                                                $(".modify-charger-button").each(function() {
                                                    var $this = $(this);

                                                    $this.on("click", function(event) {
                                                        event.preventDefault();

                                                        $.ajax({
                                                            url: "{% url 'users:get_charger' %}",
                                                            type: "POST",
                                                            data: {
                                                                csrfmiddlewaretoken: $("#modify-charger input[name=csrfmiddlewaretoken]").val(),
                                                                charger_id: $this.data("chargerid"),
                                                                modify: "False"
                                                            },
                                                            success: function(response) {
                                                                openOffcanvas(response);
                                                            },
                                                            error: function(xhr) {
                                                                console.log(xhr.status + ": " + xhr.responseText);
                                                            }
                                                        });

                                                        function openOffcanvas(data) {
                                                            $("#modify-charger-content").replaceWith(data);
                                                            UIkit.offcanvas("#modify-charger").show();
                                                        }
                                                    });
                                                });
                                            });
                                            </script>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% if student.type == 'S' %}
                        <div>
                            <div id="fine-data" class="uk-card uk-card-default uk-card-small">
                                <div class="uk-card-header">
                                    <div class="uk-grid-small uk-flex uk-flex-middle" data-uk-grid>
                                        <div class="uk-width-expand">
                                            <span class="uk-text-large">Fines Information</span>
                                        </div>
                                        <div class="uk-width-auto">
                                            <a class="uk-button uk-button-primary uk-button-small uk-width-small" data-uk-toggle="target: #fines-add">Add Fine</a>
                                        </div>
                                    </div>
                                </div>
                                <div class="uk-card-body">
                                    <div id="fine-items" class="uk-grid-small uk-child-width-1-1" data-uk-grid>
                                        <div>
                                            <ul class="uk-child-width-expand" uk-tab>
                                                <li id="fines-tab-unpaid"><a><i class="fas fa-dollar-sign fa-fw"></i> Unpaid Fines</a></li>
                                                <li id="fines-tab-paid"><a><i class="fas fa-hand-holding-usd uk-margin-small-left"></i> Paid Fines</a></li>
                                                <li id="fines-tab-history">
                                                    <a data-uk-toggle="target: #fine-transactions"><i class="fas fa-history fa-fw uk-margin-small-right"></i>Legacy Information</a>
                                                </li>
                                            </ul>
                                            <ul class="uk-switcher uk-margin">
                                                <li id="fines-content-unpaid">
                                                    {% for transgression, data in student_unpaid_fee_list.items %}
                                                    <div class="item-container uk-margin-small">
                                                        <div class="uk-flex uk-flex-middle">
                                                            <div class="uk-padding-small uk-padding-remove-vertical">
                                                                 <span data-uk-tooltip="Fine Amount"><i class="fas fa-dollar-sign fa-fw"></i>{{ data.amount|floatformat:0 }}</span>
                                                            </div>
                                                            <div class="uk-width-expand">
                                                                <span class="uk-text-bold">{{ data.name }}</span>
                                                                <div class="uk-text-small">
                                                                    <div class="uk-text-meta uk-grid-small" data-uk-grid>
                                                                        <div>
                                                                            <span class="clipboard" data-uk-tooltip="Invoice Number" data-clipboard-action="copy" data-clipboard-text="{{ data.id }}"><i class="fas fa-hashtag"></i> {{ data.id }}</span>
                                                                            <span data-uk-tooltip="Date Assessed"><i class="far fa-calendar-plus uk-margin-small-left"></i> {{ data.created }}</span>
                                                                            <a class="uk-link-reset clipboard" href="https://www.myschoolbucks.com/ver2/admin/cashier/listinvoices" target="_blank" data-uk-tooltip="Amount Paid" data-clipboard-action="copy" data-clipboard-text="{{ data.id }}"><i class="fas fa-hand-holding-usd uk-margin-small-left"></i> {{ data.amount_paid }}</a>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    {% empty %}
                                                    <div class="uk-text-center">
                                                        <p class="uk-margin-remove">There are currently no unpaid <a href="https://www.myschoolbucks.com/ver2/admin/cashier/listinvoices" target="_blank">MySchoolBucks</a> fines on file.
                                                        <br />Select "Legacy Information" above to view legacy fines and payments.</p>
                                                    </div>
                                                    {% endfor %}
                                                </li>
                                                <li id="fines-content-paid">
                                                    {% for transgression, data in student_paid_fee_list.items %}
                                                    <div class="item-container uk-margin-small">
                                                        <div class="uk-flex uk-flex-middle">
                                                            <div class="uk-padding-small uk-padding-remove-vertical">
                                                                 <span data-uk-tooltip="Fine Amount"><i class="fas fa-dollar-sign fa-fw"></i>{{ data.amount|floatformat:0 }}</span>
                                                            </div>
                                                            <div class="uk-width-expand">
                                                                <span class="uk-text-bold">{{ data.name }}</span>
                                                                <div class="uk-text-small">
                                                                    <div class="uk-text-meta uk-grid-small" data-uk-grid>
                                                                        <div>
                                                                            <span class="clipboard" data-uk-tooltip="Invoice Number" data-clipboard-action="copy" data-clipboard-text="{{ data.id }}"><i class="fas fa-hashtag"></i> {{ data.id }}</span>
                                                                            <span data-uk-tooltip="Date Assessed"><i class="far fa-calendar-plus uk-margin-small-left"></i> {{ data.created }}</span>
                                                                            <a class="uk-link-reset clipboard" href="https://www.myschoolbucks.com/ver2/admin/cashier/listinvoices" target="_blank" data-uk-tooltip="Amount Paid" data-clipboard-action="copy" data-clipboard-text="{{ data.id }}"><i class="fas fa-hand-holding-usd uk-margin-small-left"></i> {{ data.amount_paid }}</a>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    {% empty %}
                                                    <div class="uk-text-center">
                                                        <p class="uk-margin-remove">There are currently no paid <a href="https://www.myschoolbucks.com/ver2/admin/cashier/listinvoices" target="_blank">MySchoolBucks</a> fines on file.</p>
                                                    </div>
                                                    {% endfor %}
                                                </li>
                                                <li id="fines-content-history" class="uk-text-center">
                                                    Legacy fines and payments should open in a separate modal window.
                                                    <br />If it doesn't or you need to re-access the screen, click on the tab again.
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- FINE HISTORY -->
                            <div id="fine-transactions" class="uk-modal-full" data-uk-modal>
                                <div class="uk-modal-dialog" data-uk-height-viewport>
                                    <button class="uk-modal-close-full uk-close-large" type="button" data-uk-close></button>
                                    <div class="uk-modal-header">
                                        <h2 class="uk-modal-title">Legacy Fines & Payments</h2>
                                    </div>
                                    <div class="uk-modal-body uk-padding-remove">
                                        <h3 class="uk-margin-medium-left uk-margin-medium-top">Legacy Fines</h3>
                                        <table class="uk-table uk-table-small uk-table-middle uk-table-divider" style="margin-top: 0">
                                            <thead>
                                                <th style="width:80px">Type</th>
                                                <th style="width:150px">User</th>
                                                <th style="width:125px">Date</th>
                                                <th class="uk-width-medium">Fine</th>
                                                <th style="width:80px">Amount</th>
                                                <th class="uk-width-large">Description</th>
                                                <th style="width:125px">Status</th>
                                                <th>Note</th>
                                            </thead>
                                            <tbody>
                                                {% for record in historical_fines %}
                                                <tr>
                                                    <td class="uk-text-center" style="padding-left: 15px">
                                                        {% if record.history_type == '+' %}
                                                        <span class="uk-label uk-label-success uk-width-1-1">ADDED</span>
                                                        {% elif record.history_type == '-' %}
                                                        <span class="uk-label uk-label-danger uk-width-1-1">DELETED</span>
                                                        {% elif record.history_type == '~' %}
                                                        <span class="uk-label uk-width-1-1">CHANGED</span>
                                                        {% endif %}
                                                    </td>
                                                    <td>
                                                        {% if record.history_user %}
                                                        {{ record.history_user.get_full_name }}
                                                        {% else %}
                                                        System Administrator
                                                        {% endif %}
                                                    </td>
                                                    <td>
                                                        {{ record.history_date|date:'m-d-Y' }}
                                                        <br /><span class="uk-text-meta">{{ record.history_date|date:'h:i A' }}</span>
                                                    </td>
                                                    <td>
                                                        {{ record.fine_type.name }}
                                                        <br />{{ record.fine_subtype.name }}
                                                    </td>
                                                    <td>
                                                        {% if record.fine_type.alias == 'IP1I' or record.fine_type.alias == 'IP2I' or record.fine_type.alias == 'MB1I' or record.fine_type.alias == 'MB2I' %}
                                                        ${{ record.fine_type.value }}
                                                        {% elif record.fine_subtype != None %}
                                                        ${{ record.fine_subtype.value }}
                                                        {% else %}
                                                        Error
                                                        {% endif %}
                                                    </td>
                                                    <td>
                                                        {{ record.fine_type.description }}
                                                        <br />{{ record.fine_subtype.description }}
                                                    </td>
                                                    <td>{{ record.get_status_display }}</td>
                                                    <td style="padding-right: 15px">{{ record.history_change_reason }}</td>
                                                </tr>
                                                {% empty %}
                                                <tr>
                                                    <td colspan="8" class="uk-text-center">No records to display.</td>
                                                </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                        <h3 class="uk-margin-medium-left uk-margin-medium-top">Legacy Payments</h3>
                                        <table class="uk-table uk-table-small uk-table-middle uk-table-divider" style="margin-top: 0">
                                            <thead>
                                                <th style="width:80px">User</th>
                                                <th style="width:125px">Date</th>
                                                <th class="uk-width-medium">Description</th>
                                                <th style="width:80px">Amount</th>
                                                <th style="width:125px">Paid</th>
                                                <th>Payer Name</th>
                                                <th>Payer Email</th>
                                            </thead>
                                            <tbody>
                                                {% for record in schoolpay_data %}
                                                <tr>
                                                    <td class="uk-text-center" style="padding-left: 15px">
                                                        {{ record.author }}
                                                    </td>
                                                    <td>
                                                        {{ record.timestamp }}
                                                    </td>
                                                    <td>
                                                        {{ record.description }}
                                                    </td>
                                                    <td>
                                                        ${{ record.amount }}
                                                    </td>
                                                    <td>
                                                        ${{ record.paid }}
                                                    </td>
                                                    <td>
                                                        {{ record.payer_name }}
                                                    </td>
                                                    <td>
                                                        {{ record.payer_email }}
                                                    </td>
                                                </tr>
                                                {% empty %}
                                                <tr>
                                                    <td colspan="7" class="uk-text-center">No records to display.</td>
                                                </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            <!-- /FINE HISTORY -->
                        </div>
                        {% endif %}
                        {% if student.type == "S" %}
                        <div>
                            <div class="uk-card uk-card-default uk-card-small">
                                <div class="uk-card-header">
                                    <div class="uk-grid-small uk-flex uk-flex-middle" data-uk-grid>
                                        <div class="uk-width-expand">
                                            <span class="uk-text-large">Staging Data</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="uk-card-body">
                                    <!-- STAGING INFORMATION -->
                                    <div id="staging-data">
                                        <form id="update-staging-form" class="uk-form-stacked" method="POST">
                                            {% csrf_token %}
                                            <div class="uk-grid-small uk-child-width-1-2" data-uk-grid>
                                                <div>
                                                    <label class="uk-form-label uk-text-bold" for="form-stacked-text">Device Bin:</label>
                                                    <div class="uk-form-controls">
                                                        <input class="uk-input" id="staging-bin" type="text" placeholder="Enter bin..." value="{{ staging_data.bin }}" maxlength="10" required />
                                                    </div>
                                                </div>
                                                <div>
                                                    <label class="uk-form-label uk-text-bold" for="form-stacked-text">Device BPI:</label>
                                                    <div class="uk-form-controls">
                                                        <input class="uk-input" id="staging-bpi" type="text" placeholder="Enter BPI..." value="{{ staging_data.bpi }}" required />
                                                    </div>
                                                </div>
                                                {% if l5qdata_exists and l5qdata.iiq_ticket != None %}
                                                {% if l5qdata.iiq_ticket != '' %}
                                                <div class="uk-width-1-1">
                                                    <label class="uk-form-label uk-text-warning" for="form-stacked-text">
                                                        There is currently an <a href="https://flaglerschools.incidentiq.com/agent/tickets/open?flyout-type=agent-ticket&flyout-id={{ l5qdata.iiq_ticket }}" target="_blank">IncidentIQ ticket <i class="fas fa-external-link-alt"></i></a> attached to the next staging event. Please make sure that the ticket's actions are updated before staging and enter the ticket number below to close it:
                                                    </label>
                                                    <div class="uk-form-controls">
                                                        <input class="uk-input" id="iiq-ticket-number" type="text" placeholder="Enter ticket number..." required />
                                                    </div>
                                                </div>
                                                {% endif %}
                                                {% endif %}
                                            </div>
                                            <div class="uk-margin-small uk-grid-small" data-uk-grid>
                                                <div class="uk-width-expand">
                                                    {% if staging_data.author != None %}
                                                    {{ staging_data.author }} ({{ staging_data.created|date:'F jS, Y' }})
                                                    {% endif %}
                                                </div>
                                                <div class="uk-text-right">
                                                    <button type="submit" class="uk-button uk-button-small uk-button-danger uk-width-small">Update</button>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        <!-- /STUDENT INFORMATION -->
    </div>
</div>
<!-- STUDENT TEMPRORARY ID -->
<div id="student-tempid" data-uk-modal>
    <div class="uk-modal-dialog">
        <div class="uk-modal-header">
            <h2 class="uk-modal-title">Student Temprorary ID</h2>
        </div>
        <div class="uk-modal-body">
            <div class="uk-margin">
                <h4 class="uk-heading-divider">Options</h4>
                <div class="uk-grid-small uk-child-width-1-3" data-uk-grid>
                    <div>
                        <label class="uk-form-label uk-margin-remove">
                            <input id="student-tempid-studentid-controller" type="checkbox" class="uk-checkbox" checked /> School ID
                        </label>
                    </div>
                    <div>
                        <label class="uk-form-label uk-margin-remove">
                            <input id="student-tempid-timestamp-controller" type="checkbox" class="uk-checkbox" checked /> Timestamp
                        </label>
                    </div>
                </div>
            </div>
            <div class="uk-margin">
                <h4 class="uk-heading-divider">Preview</h4>
                <div id="student-tempid-dymo" class="student-tempid-print uk-card uk-card-default uk-card-small">
                    <div style="padding:7px">
                        <div class="uk-margin-small">
                            <div class="uk-grid-small" data-uk-grid>
                                <div class="uk-width-auto uk-text-right">
                                    <img src="https://www.gstatic.com/images/branding/product/2x/avatar_square_grey_48dp.png" width="80" />
                                </div>
                                <div class="uk-width-expand">
                                    <span class="uk-text-large uk-text-bold">{{ student.name }}</span>
                                    <br /><span class="uk-text-muted">{{ student.get_grade_full }}</span>
                                    <br />{{ student.location.name }}
                                </div>
                            </div>
                        </div>
                        <div class="uk-margin-small uk-margin-remove-bottom uk-text-center">
                            <svg id="barcode"></svg>
                            <div class="uk-text-meta uk-text-center" style="font-size:11px">
                                <div id="student-tempid-studentid" class="uk-text-bold">
                                    {{ student.id }}
                                </div>
                                <div id="student-tempid-timestamp">
                                    {{ current_datetime }}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="uk-modal-footer uk-text-right">
            <button type="button" class="uk-button uk-button-default uk-modal-close">Cancel</button>
            <button type="button" class="uk-button uk-button-primary" onclick="printTempId('student-tempid-dymo')">Print DYMO</button>
        </div>
        <script>
        JsBarcode("#barcode", "{{ student.id }}", {
            format: "CODE39",
            lineColor: "#000",
            width: 1.25,
            height: 40,
            displayValue: false
        });

        $("#student-tempid-studentid-controller").change(function() {
            if ($(this).prop("checked")) {
                $("#student-tempid-studentid").show();
            } else {
                $("#student-tempid-studentid").hide();
            }
        });

        $("#student-tempid-timestamp-controller").change(function() {
            if ($(this).prop("checked")) {
                $("#student-tempid-timestamp").show();
            } else {
                $("#student-tempid-timestamp").hide();
            }
        });

        function printTempId(divId) {
            var printContents = document.getElementById(divId).innerHTML;
            var originalContents = document.body.innerHTML;

            document.body.innerHTML = printContents;
            window.print();
            document.body.innerHTML = originalContents;
        }
        </script>
    </div>
</div>
<!-- /STUDENT TEMPRORARY ID -->
<!-- STUDENT INFORMATION LABEL -->
<div id="student-infolabel" data-uk-modal>
    <div class="uk-modal-dialog">
        <div class="uk-modal-header">
            <h2 class="uk-modal-title">Student Information Label</h2>
        </div>
        <div class="uk-modal-body">
            <div class="uk-margin">
                <h4 class="uk-heading-divider">Options</h4>
                <div class="uk-grid-small uk-child-width-1-3" data-uk-grid>
                    <div>
                        <label class="uk-form-label uk-margin-remove">
                            <input id="student-infolabel-email-controller" type="checkbox" class="uk-checkbox" checked /> Add Email Information
                        </label>
                    </div>
                    <div>
                        <label class="uk-form-label uk-margin-remove">
                            <input id="student-infolabel-video-controller" type="checkbox" class="uk-checkbox" /> Add How-to Videos Link
                        </label>
                    </div>
                </div>
            </div>
            <div class="uk-margin">
                <h4 class="uk-heading-divider">Preview</h4>
                <div id="student-infolabel-print" class="uk-card uk-card-default uk-card-small">
                    <div style="padding:5px">
                        <span class="uk-text-uppercase uk-text-bold">{{ student.name }}</span>
                        <div>
                            <div class="uk-text-small">
                                Username: {{ student.username }}
                                <br />Password: {{ student.password }}
                            </div>
                            <div class="uk-text-small">
                                <div id="student-infolabel-email">
                                    <span class="uk-text-bold">Google & Email Logon</span>
                                    <br />{{ student.username }}@flaglercps.org
                                </div>
                                <div id="student-infolabel-video">
                                    <span class="uk-text-bold">Technology Videos</span>
                                    <br />http://fcsb.link/techhowto
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="uk-modal-footer uk-text-right">
            <button type="button" class="uk-button uk-button-default uk-modal-close">Cancel</button>
            <button type="button" class="uk-button uk-button-primary" onclick="printTempId('student-infolabel-print')">Print</button>
        </div>
        <script>
        $("#student-infolabel-email-controller").change(function() {
            if ($(this).prop("checked")) {
                $("#student-infolabel-email").show();
            } else {
                $("#student-infolabel-email").hide();
            }
        });

        $("#student-infolabel-video-controller").change(function() {
            if ($(this).prop("checked")) {
                $("#student-infolabel-video").show();
            } else {
                $("#student-infolabel-video").hide();
            }
        }).change();

        function printTempId(divId) {
            var printContents = document.getElementById(divId).innerHTML;
            var originalContents = document.body.innerHTML;

            document.body.innerHTML = printContents;
            window.print();
            document.body.innerHTML = originalContents;
        }
        </script>
    </div>
</div>
<!-- /STUDENT INFORMATION LABEL -->
<!-- DLM DETAILS -->
<div id="dlm-details" data-uk-offcanvas="flip: true; overlay: true;">
    <div class="uk-offcanvas-bar">
        <button class="uk-offcanvas-close" type="button" data-uk-close></button>
        <!-- REGISTRATION INFORMATION -->
        <div id="registration-data">
            <h3>Registration Details</h3>
            {% if ddata %}
            <table>
                <tr>
                    <td class="uk-text-bold">
                        Complete:
                    </td>
                    <td>
                        <i class="far fa-check-circle uk-text-success"></i>
                    </td>
                </tr>
                <tr>
                    <td class="uk-text-bold">
                        Timestamp:
                    </td>
                    <td>
                        {{ ddata.created|date:"m-d-Y" }} <span class="uk-text-meta">{{ ddata.created|date:"h:m A" }}</span>
                    </td>
                </tr>
            </table>
            <table id="parent-information" class="uk-margin-small-top">
                <tr>
                    <td class="uk-text-bold">
                        Parent Name:
                    </td>
                    <td>
                        {{ ddata.parent_name }}
                    </td>
                </tr>
                <tr>
                    <td class="uk-text-bold">
                        Parent Address:
                    </td>
                    <td>
                        {{ ddata.parent_address }}
                    </td>
                </tr>
                <tr>
                    <td class="uk-text-bold">
                        Parent Email:
                    </td>
                    <td>
                        {{ ddata.parent_email }}
                    </td>
                </tr>
                <tr>
                    <td class="uk-text-bold">
                        Parent Phone:
                    </td>
                    <td>
                        {{ ddata.parent_phone }}
                    </td>
                </tr>
            </table>
            <div id="dlmr-info-actions" class="uk-grid-small uk-margin-top" data-uk-grid>
                <div>
                    <a class="uk-button uk-button-warning uk-button-small" data-uk-toggle="target: #resend-confirmation-modal">Resend Confirmation</a>
                </div>
                <div>
                    <button type="button" id="archive-data-submit" class="uk-button uk-button-danger uk-button-small">Archive Data</button>
                </div>
            </div>
            {% else %}
            <div>
                No registration data could be found.
            </div>
            {% endif %}
        </div>
        <!-- /REGISTRATION INFORMATION -->
        <hr />
        <!-- PAYMENT INFORMATION -->
        <div id="payment-data">
            <h3>Registration Payment</h3>
            {% if ddata %}
            <table>
                <tr>
                    <td class="uk-text-bold">
                        Complete:
                    </td>
                    <td>
                        <i class="far fa-check-circle uk-text-success"></i>
                    </td>
                </tr>
                <tr>
                    <td class="uk-text-bold">
                        Timestamp:
                    </td>
                    <td>
                        {{ ddata.created|date:"Y-m-d, h:m A" }}
                    </td>
                </tr>
            </table>
            {% else %}
            <div>
                No registration payment data could be found.
            </div>
            {% endif %}
        </div>
        <!-- /PAYMENT INFORMATION -->
    </div>
</div>
<!-- /DLM DETAILS -->
<!-- REGISTRATION CONFIRMATION -->
<div id="resend-confirmation-modal" data-uk-modal>
    <div class="uk-modal-dialog">
        <form id="resend-confirmation-form" class="uk-form-vertical uk-margin-large" method="POST">
            {% csrf_token %}
            <div class="uk-modal-header">
                <h2 class="uk-modal-title">Email Confirmation</h2>
            </div>
            <div class="uk-modal-body">
                <div class="uk-margin-small">
                    <div class="uk-form-label uk-text-bold">Email address:</div>
                    <div class="uk-form-controls uk-form-controls-text">
                        <input id="resend-email-address" type="text" class="uk-input" value="{{ ddata.parent_email }}" />
                    </div>
                </div>
            </div>
            <div class="uk-modal-footer uk-text-right">
                <button id="resend-confirmation-button" type="submit" class="uk-button uk-button-danger">Resend</button>
                <a class="uk-button uk-button-default uk-modal-close">Cancel</a>
            </div>
        </form>
    </div>
</div>
<!-- /REGISTRATION CONFIRMATION -->
<!-- ADD DEVICE -->
<div id="add-device" data-uk-offcanvas="flip: true; overlay: true;">
    {% csrf_token %}
    <div class="uk-offcanvas-bar">
        <button class="uk-offcanvas-close" type="button" data-uk-close></button>
        <span class="uk-text-large">Add Device</span>
        <div id="add-device-content" class="uk-margin-top">
            <div id="add-device-notifications"></div>
            <form id="add-device-form">
                {% csrf_token %}
                <div class="uk-margin">
                    <b>Owner:</b> {{ student.name }}
                    <br /><b>School ID:</b> {{ student.id }}
                </div>
                <h5 class="uk-heading-divider uk-margin-top uk-text-uppercase uk-text-bold">Device Information</h5>
                <div class="uk-margin">
                    <label for="device-type" class="uk-form-label">Which device are you assigning?</label>
                    <select id="modify-assets-search" style="width: 100%">
                        <option></option>
                    </select>
                </div>
                <h5 class="uk-heading-divider uk-margin uk-text-uppercase uk-text-bold">Additional Information</h5>
                <div class="uk-margin">
                    <p class="uk-form-label" style="margin-bottom:4px">Why are you adding a device? (Quick Notes)</p>
                    <div class="uk-grid-small uk-child-width-1-1" data-uk-grid>
                        <label class="uk-form-label"><input type="checkbox" id="device-quicknote-ndns" class="uk-checkbox" /> "New device for new student."</label>
                    </div>
                    <script>
                    $(document).on("click", "#device-quicknote-ndns", function() {
                        if ($(this).prop("checked")) {
                            $("#device-note").append("New device for new student.");
                            $("#device-quicknote-ndns").prop("checked", true);
                        }
                    });
                    </script>
                </div>
                <div class="uk-margin">
                    <label for="device-note" class="uk-form-label">Why are you adding a device?</label>
                    <textarea id="device-note" rows="3" class="uk-textarea" style="resize: none;" placeholder="Newly enrolled student is getting a device." required></textarea>
                </div>
                <hr />
                <div class="uk-text-right">
                    <button id="add-device-form-submit" type="submit" class="uk-button uk-button-danger">Add</button>
                    <a href="#add-device" class="uk-button uk-button-default" data-uk-toggle>Cancel</a>
                </div>
            </form>
            <script>
            $(document).on("submit", "#add-device-form", function(event) {
                event.preventDefault();

                $('#add-device-form-submit').replaceWith('<div uk-spinner></div>');

                $.ajax({
                    type: "POST",
                    url: "{% url 'users:add_device_submit' %}",
                    data: {
                        csrfmiddlewaretoken: $("#add-device-form input[name=csrfmiddlewaretoken]").val(),
                        student_id: "{{ student.id }}",
                        device_id: $("#add-device-form #modify-assets-search").val(),
                        assign_note: $("#add-device-form #device-note").val()
                    },
                    error: function(xhr, errmsg, err) {
                        console.log(xhr.status + ': ' + xhr.responseText);
                    },
                    complete: function() {
                        window.location.reload(true);
                    }
                });
            });
            </script>
            <div class="meta-container uk-margin">
                <div class="uk-form-label uk-text-bold uk-text-uppercase">Meta information:</div>
                <div class="uk-form-controls uk-form-controls-text">
                    <b>Author:</b> {{ request.user.get_full_name }} &centerdot; <b>Timestamp:</b> {{ current_datetime|date:'F d, Y ~H:i A' }}
                </div>
            </div>
        </div>
    </div>
</div>
<!-- /ADD DEVICE -->
<!-- MODIFY DEVICE -->
<div id="modify-device" data-uk-offcanvas="flip: true; overlay: true;">
    {% csrf_token %}
    <div class="uk-offcanvas-bar">
        <button class="uk-offcanvas-close" type="button" data-uk-close></button>
        <span class="uk-text-large">Check-in Device</span>
        <div id="modify-device-content"></div>
    </div>
</div>
<!-- /MODIFY DEVICE -->
<!-- ADD CHARGER -->
<div id="add-charger" data-uk-offcanvas="flip: true; overlay: true;">
    {% csrf_token %}
    <div class="uk-offcanvas-bar">
        <button class="uk-offcanvas-close" type="button" data-uk-close></button>
        <span class="uk-text-large">Add Charger</span>
        <div id="add-charger-content" class="uk-margin-top">
            <div id="add-charger-notifications"></div>
            <form id="add-charger-form">
                {% csrf_token %}
                <div class="uk-margin">
                    <b>Owner:</b> {{ student.name }}
                    <br /><b>School ID:</b> {{ student.id }}
                </div>
                <h5 class="uk-heading-divider uk-margin-top uk-text-uppercase uk-text-bold">Add Charger</h5>
                <div class="uk-margin">
                    <label for="charger-type" class="uk-form-label">What type of charger are you assigning?</label>
                    <select id="charger-type" class="uk-select" required>
                        <option value="">--</option>
                        {% for type in charger_types %}
                        <option value="{{ type.id }}">{{ type.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="uk-margin">
                    <p class="uk-form-label" style="margin-bottom:4px">What's the condition of the charger, overall?</p>
                    <div class="uk-grid-small uk-grid-row-collapse" data-uk-grid>
                    {% for condition in charger_conditions %}
                        {% if condition.id != 'D' %}
                        <label class="uk-form-label"><input type="radio" name="charger-condition" class="uk-radio" value="{{ condition.id }}"{% if forloop.first %} required{% endif %} /> {{ condition.name }}</label>
                        {% endif %}
                    {% endfor %}
                    </div>
                </div>
                <h5 class="uk-heading-divider uk-margin uk-text-uppercase uk-text-bold">Additional Information</h5>
                <div class="uk-margin">
                    <p class="uk-form-label" style="margin-bottom:4px">Why are you adding the charger? (Quick Notes)</p>
                    <div class="uk-grid-small uk-child-width-1-1" data-uk-grid>
                        <label class="uk-form-label"><input type="checkbox" id="charger-quicknote-cad" class="uk-checkbox" /> "Charger assigned with device."</label>
                    </div>
                    <script>
                    $(document).on("click", "#charger-quicknote-cad", function() {
                        if ($("#charger-quicknote-cad").prop("checked")) {
                            $("#charger-note").append("Charger assigned with device.");
                            $("#charger-quicknote-cad").prop("checked", true);
                        }
                    });
                    </script>
                </div>
                <div class="uk-margin">
                    <label for="charger-note" class="uk-form-label">Why are you adding the charger?</label>
                    <textarea id="charger-note" rows="3" class="uk-textarea" style="resize: none;" placeholder="User damaged the cable and it needs to be replaced." required></textarea>
                </div>
                <hr />
                <div class="uk-text-right">
                    <button id="add-charger-form-submit" type="submit" class="uk-button uk-button-danger">Add</button>
                    <a href="#add-charger" class="uk-button uk-button-default" data-uk-toggle>Cancel</a>
                </div>
            </form>
            <script>
            $(document).on("submit", "#add-charger-form", function(event) {
                event.preventDefault();

                $('#add-charger-form-submit').replaceWith('<div uk-spinner></div>');

                $.ajax({
                    type: "POST",
                    url: "{% url 'users:add_charger_submit' %}",
                    data: {
                        csrfmiddlewaretoken: $("#add-charger-form input[name=csrfmiddlewaretoken]").val(),
                        student_id: "{{ student.id }}",
                        charger_type: $("#add-charger-form #charger-type").val(),
                        charger_condition: $("#add-charger-form input[name=charger-condition]").val(),
                        charger_note: $("#add-charger-form #charger-note").val()
                    },
                    error: function(xhr, errmsg, err) {
                        console.log(xhr.status + ': ' + xhr.responseText);
                    },
                    complete: function() {
                        window.location.reload(true);
                    }
                });
            });
            </script>
            <div class="meta-container uk-margin">
                <div class="uk-form-label uk-text-bold uk-text-uppercase">Meta information:</div>
                <div class="uk-form-controls uk-form-controls-text">
                    <b>Author:</b> {{ request.user.get_full_name }} &centerdot; <b>Timestamp:</b> {{ current_datetime|date:'F d, Y ~H:i A' }}
                </div>
            </div>
        </div>
    </div>
</div>
<!-- /ADD CHARGER -->
<!-- MODIFY CHARGER -->
<div id="modify-charger" data-uk-offcanvas="flip: true; overlay: true;">
    {% csrf_token %}
    <div class="uk-offcanvas-bar">
        <button class="uk-offcanvas-close" type="button" data-uk-close></button>
        <span class="uk-text-large">Edit Charger</span>
        <div id="modify-charger-content"></div>
    </div>
</div>
<!-- /MODIFY CHARGER -->
<!-- ADD FINE -->
<div id="fines-add" data-uk-offcanvas="flip: true; overlay: true;">
    <div class="uk-offcanvas-bar">
        <button class="uk-offcanvas-close" type="button" data-uk-close></button>
        <form id="add-fine-form" class="uk-form-vertical" method="POST">
            {% csrf_token %}
            <span class="uk-text-large">Add Student Fine</span>
            <div class="uk-alert-warning uk-text-justify" uk-alert>
                <p>This information is submitted directly to MySchoolBucks and will shortly thereafter email an invoice to all addresses on file. There is no way to reverse this unless you sign into MySchoolBucks and delete the invoice!</p>
            </div>
            <div class="uk-margin">
                <h5 class="uk-heading-divider uk-margin-top uk-text-uppercase uk-text-bold">Student Information</h5>
                <div class="uk-form-controls uk-form-controls-text">
                    {{ student.name }} ({{ student.id }})
                    <br />{{ student.location }} &centerdot;
                    {% if student.grade == 'GD' %}
                    Graduated
                    {% elif student.grade == 'KG' %}
                    Kindergarten
                    {% elif student.grade == '00' %}
                    No Grade
                    {% else %}
                    {{ student.grade | ordinal }} Grade
                    {% endif %}
                </div>
            </div>
            <div class="uk-margin">
                <h5 class="uk-heading-divider uk-margin-top uk-text-uppercase uk-text-bold">Fine Information</h5>
                <div class="uk-form-controls uk-form-controls-text uk-margin-small">
                    Which device is this fine associated with (if applicable)?
                    <select id="fine-select-device" class="uk-select">
                        <option value="NA">-</option>
                        {% for device, property in assigned_devices.items %}
                        <option value="{{ device }}"{% if forloop.first %} selected{% endif %}>{{ property.model|remove_parentheses }} ({{ device }})</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="uk-form-controls uk-form-controls-text uk-margin-small">
                    What type of fine is this?
                    <select id="fine-select-finetype" class="uk-select">
                        <option value="NA">-</option>
                        {% for type in fine_types %}
                        <option value="{{ type.alias }}"{% if type.alias == 'FINE' %} selected{% endif %}>{{ type.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="uk-form-controls uk-form-controls-text uk-margin-small">
                    What is this fine regarding, specifically?
                    <select id="fine-select-finesubtype" class="uk-select" required>
                        {% for type in fine_subtypes %}
                        <option value="{{ type.alias }}"{% if forloop.first %} selected{% endif %}>{{ type.name }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            <div class="uk-margin">
                <h5 class="uk-heading-divider uk-margin-top uk-text-uppercase uk-text-bold">Additional Notes</h5>
                <div class="uk-form-controls uk-form-controls-text">
                    <textarea id="fine-select-note" rows="3" class="uk-textarea" style="resize: none;" placeholder="For internal records only: this will automatically add a note to the student's account in SADIS, but will not appear on MySchoolBucks."></textarea>
                </div>
            </div>
            <div class="uk-margin uk-text-right">
                <button id="add-fine-submit" type="submit" class="uk-button uk-button-danger">Add Fine</button>
                <a href="#fines-add" class="uk-button uk-button-default" data-uk-toggle>Cancel</a>
            </div>
            <div class="meta-container uk-margin">
                <div class="uk-grid-small uk-flex uk-flex-middle" data-uk-grid>
                    <div class="uk-width-expand">
                        <div class="uk-form-label uk-text-bold uk-text-uppercase">Meta information:</div>
                        <div class="uk-form-controls uk-form-controls-text">
                            <b>Author:</b> {{ request.user.get_full_name }} &centerdot; <b>Timestamp:</b> {{ current_datetime|date:'F d, Y ~H:i A' }}
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>
<!-- /ADD FINE -->
<!-- Start Student Password Modal -->
<div id="change-password-modal" class="uk-flex-top" uk-modal>
    <div class="uk-modal-dialog uk-modal-body">
        <h2 class="uk-modal-title">Password Update/Change</h2>
        <form id="update-password" method="POST">
            {% csrf_token %}
            <div class="uk-margin">
                <div class="uk-form-controls">
                    <input id="updated-student-password" type="text" class="uk-input" autofocus="autofocus" value="" placeholder="Enter a new password">
                </div>
            </div>
            <div class="uk-margin uk-text-right">
                <button type="button" class="uk-button uk-button-default uk-modal-close">Cancel</button>
                <button id="update-password-submit" type="submit" class="uk-button uk-button-primary">Save</button>
            </div>
        </form>
    </div>
</div>
<!-- End Student Password Modal -->
<script>
// On Ready
$(document).ready(function() {
    var clipboard = new ClipboardJS('.clipboard');

    $('#modify-assets-search').select2({
        placeholder: 'Search for device...',
        width: 'resolve',
        minimumInputLength: 2,
        ajax: {
            delay: 500,
            dataType: 'json',
            type: 'POST',
            data: function (params) {
                return {
                    csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
                    action: 'modify-assets-search',
                    search: params.term,
                }
            },
            processResults: function(data, params) {
                return {
                    results: $.map(data, function(item) {
                        return {
                            id: item.id,
                            text: item.text
                        }
                    })
                };
            }
        }
    });

    $(document).on("click", "#get-iiq-id", function(event) {
        event.preventDefault();

        $.ajax({
            type: "POST",
            data: {
                csrfmiddlewaretoken: "{{ csrf_token }}",
                action: "get-iiq-id-submit"
            },
            error: function(xhr, errmsg, err) {
                console.log(xhr.status + ": " + xhr.responseText);

                $("#profile-items").prepend(
                    '<div>' +
                        '<div class="uk-alert-danger" uk-alert>' +
                            '<a class="uk-alert-close" uk-close></a>' +
                            '<p>Something went wrong! Please try again and if the issue persists, please contact your technology support technician to troubleshoot the issue.</p>' +
                        '</div>' +
                    '</div>'
                );
            },
            complete: function() {
                $("#profile-data").load(location.href + " #profile-data>*", "");
            }
        });
    });

    $(document).on("submit", "#resend-confirmation-form", function(event) {
        event.preventDefault();

        $("#resend-confirmation-button").replaceWith('<div id="resend-confirmation-loading"><i class="fas fa-sync fa-spin"></i></div>');

        $.ajax({
            type: "POST",
            data: {
                csrfmiddlewaretoken: $("input[name=csrfmiddlewaretoken]").val(),
                action: "resend-registration-email",
                resend_address: $("#resend-email-address").val()
            },
            success: function(json) {
                document.getElementById("resend-confirmation-form").reset();
            },
            error: function(xhr, errmsg, err) {
                console.log(xhr.status + ": " + xhr.responseText);
            },
            complete: function() {
                $("#resend-confirmation-loading").replaceWith('<button id="resend-confirmation-button" class="uk-button uk-button-small uk-button-danger">Resend Confirmation</button>');
                $('#parent-information').load(location.href + ' #parent-information>*', '');
                $('#resend-confirmation-modal').load(location.href + ' #resend-confirmation-modal>*', '');

                UIkit.modal('#resend-confirmation-modal').hide();
            }
        });
    });

    $(document).on("submit", "#add-note-form", function(event) {
        event.preventDefault();

        $("#add-note-submit").replaceWith('<button id="add-note-submit" type="submit" class="uk-button uk-button-default uk-button-small uk-width-small" disabled><i class="fas fa-sync fa-spin"></i></button>');

        $.ajax({
            url: "{% url 'users:add_note' %}",
            data: {
                csrfmiddlewaretoken: $("#add-note-form input[name=csrfmiddlewaretoken]").val(),
                student_id: "{{ student.id }}",
                note_body: $("#add-note-body").val()
            },
            dataType: "json",
            error: function(xhr) {
                console.log(xhr.status + ": " + xhr.responseText);
            },
            complete: function(response_data) {
                if (response_data.response_code == 404) {
                    $("#add-note-form").prepend(
                        '<div class="uk-alert-danger" uk-alert>' +
                            '<a class="uk-alert-close" uk-close></a>' +
                            '<p>' + response_data.response_message + '</p>' +
                        '</div>'
                    );
                } else {
                    window.location.reload(true);
                }
            }
        });
    });

    // Eligibility
    $(document).on("click", "#change-ec", function(event) {
        event.preventDefault();
        var ec_id = $(this).data("id");

        $.ajax({
            type: 'POST',
            data: {
                csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
                action: 'change-student-ec',
                role_id: ec_id
            },
            error: function(xhr, errmsg, err) {
                console.log(xhr.status + ': ' + xhr.responseText);
            },
            complete: function() {
                window.location.reload(true);
            }
        });
    });

    // Archive Data
    $(document).on("click", "#archive-data-submit", function(event) {
        event.preventDefault();

        $.ajax({
            type: 'POST',
            url: "{% url 'users:archive_dlmr_data' %}",
            data: {
                csrfmiddlewaretoken: "{{ csrf_token }}",
                student_id: "{{ student.id }}"
            },
            error: function(xhr, errmsg, err) {
                console.log(xhr.status + ': ' + xhr.responseText);
            },
            complete: function() {
                window.location.reload(true);
            }
        });
    });

    // Status
    $(document).on("click", "#change-status", function(event) {
        event.preventDefault();
        var foreign_status_id = $(this).data("id");

        $.ajax({
            type: 'POST',
            data: {
                csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
                action: 'change-student-status',
                foreign_status_id: foreign_status_id
            },
            error: function(xhr, errmsg, err) {
                console.log(xhr.status + ': ' + xhr.responseText);
            },
            complete: function() {
                window.location.reload(true);
            }
        });
    });

    // Transfer
    $(document).on("click", "#profile-complete-transfer", function(event) {
        event.preventDefault();

        $('#student-profile-action').replaceWith(
        '<button class="uk-button uk-button-default uk-button-small uk-width-small" disabled>' +
            '<i class="fas fa-sync fa-spin"></i>' +
        '</button>'
        )

        $.ajax({
            type: 'POST',
            data: {
                csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
                action: 'complete-student-transfer'
            },
            error: function(xhr, errmsg, err) {
                console.log(xhr.status + ': ' + xhr.responseText);
            },
            complete: function() {
                window.location.reload(true);
            }
        });
    });

    // IncidentIQ
    $(document).on('submit', '#get-iiq-id-form', function(event) {
        event.preventDefault();

        $.ajax({
            type: 'POST',
            data: {
                csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
                action: 'get-iiq-id-submit'
            },
            success: function(json) {
                document.getElementById('get-iiq-id-form').reset();
            },
            error: function(xhr, errmsg, err) {
                console.log(xhr.status + ': ' + xhr.responseText);
            },
            complete: function() {
                $('#user-header').load(location.href + ' #user-header>*', '');
                $('#profile-data').load(location.href + ' #profile-data>*', '');
                $('#asset-data').load(location.href + ' #asset-data>*', '');
            }
        });
    });

    // IncidentIQ
    $(document).on('submit', '#update-password', function(event) {
        event.preventDefault();

        $.ajax({
            type: 'POST',
            url: '{% url "users:update_student_password" %}',
            data: {
                csrfmiddlewaretoken: $('#update-password input[name=csrfmiddlewaretoken]').val(),
                student_id: '{{ student.id }}',
                new_password: $("#updated-student-password").val()
            },
            success: function(json) {
                window.location.reload(true);
            },
            error: function(xhr, errmsg, err) {
                console.log(xhr.status + ': ' + xhr.responseText);
            }
        });
    });

    $(document).on("click", "#profile-sync-iiq", function(event) {
        event.preventDefault();

        $('#student-profile-action').replaceWith('<div uk-spinner></div>')

        $.ajax({
            type: 'POST',
            data: {
                csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
                action: 'sync-iiq-submit'
            },
            error: function(xhr, errmsg, err) {
                console.log(xhr.status + ': ' + xhr.responseText);
            },
            complete: function() {
                window.location.reload(true);
            }
        });
    });

    // Notes
    $(document).on("submit", "#delete-note-form", function(event) {
        event.preventDefault();

        var note_id = $(document.activeElement).prev().val()

        UIkit.modal.confirm('Are you sure you want to delete this note?').then(function() {
            $.ajax({
               type: 'POST',
               data: {
                   csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
                   action: 'delete-note-submit',
                   to_delete: note_id
               },
               success: function(json) {
                   document.getElementById('delete-note-form').reset();
               },
               error: function(xhr, errmsg, err) {
                   console.log(xhr.status + ': ' + xhr.responseText);
               },
               complete: function() {
                   $('#note-items').load(location.href + ' #note-items>*', '');
                   $('#create-invoice').load(location.href + ' #create-invoice>*', '');
                   $('#note-transactions').load(location.href + ' #note-transactions>*', '');
               }
            });

            return true
        }, function() {
            return false
        });
    });

    // Assets
    $(document).on("click", "#assets-sync-iiq", function(event) {
        event.preventDefault();

        $('#student-assets-action').replaceWith('<div uk-spinner></div>');

        $.ajax({
            type: "POST",
            data: {
                csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
                action: 'sync-assets-submit'
            },
            error: function(xhr, errmsg, err) {
                console.log(xhr.status + ": " + xhr.responseText);
            },
            complete: function() {
                window.location.reload(true);
            }
        });
    });

    var add_assets_set = new Array();
    var remove_assets_set = new Array();

    $(document).on('click', '#modify-assets-add', function(event) {
        event.preventDefault();

        var asset_id = $('#modify-assets-search').val();
        add_assets_set.push(asset_id);

        $.ajax({
            type: 'POST',
            data: {
                csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
                action: 'get-internal-asset',
                asset_id: asset_id
            },
            success: function(json) {
                $('#modify-assets-added').append(
                '<div>' +
                    '<div class="item-container item-container-success">' +
                        '<div class="uk-flex uk-flex-middle">' +
                            '<div class="uk-padding-small uk-padding-remove-vertical">' +
                                '<i class="fas fa-laptop fa-2x"></i>' +
                            '</div>' +
                            '<div class="uk-width-expand">' +
                                '<span class="uk-text-bold">' + json.manufacturer + ' ' + json.model + '</span>' +
                                '<div class="uk-text-small">' +
                                    '<i class="fas fa-hashtag"></i>' + ' ' + json.id +
                                '</div>' +
                            '</div>' +
                        '</div>' +
                    '</div>' +
                '</div>'
                );
            },
            error: function(xhr, errmsg, err) {
                console.log(xhr.status + ': ' + xhr.responseText);
            }
        });
    });

    $(document).on('click', '#modify-assets-remove', function(event) {
        event.preventDefault();

        var asset_id = $(this).data('id');
        remove_assets_set.push(asset_id);

        $.ajax({
            type: 'POST',
            data: {
                csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
                action: 'get-internal-asset',
                asset_id: asset_id
            },
            success: function(json) {
                $('#modify-assets-added').append(
                    '<div>' +
                        '<div class="item-container item-container-danger">' +
                            '<div class="uk-flex uk-flex-middle">' +
                                '<div class="uk-padding-small uk-padding-remove-vertical">' +
                                    '<i class="fas fa-laptop fa-2x"></i>' +
                                '</div>' +
                                '<div class="uk-width-expand">' +
                                    '<span class="uk-text-bold">' + json.manufacturer + ' ' + json.model + '</span>' +
                                    '<div class="uk-text-small">' +
                                        '<i class="fas fa-hashtag"></i>' + ' ' + json.id +
                                    '</div>' +
                                '</div>' +
                            '</div>' +
                        '</div>' +
                    '</div>'
                );
            },
            error: function(xhr, errmsg, err) {
                console.log(xhr.status + ': ' + xhr.responseText);
            }
        });
    });

    $(document).on('submit', '#modify-assets-form', function(event) {
        event.preventDefault();

        $('#modify-assets-apply').replaceWith('<div uk-spinner></div>');

        $.ajax({
            type: 'POST',
            data: {
                csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
                action: 'modify-assets-submit',
                assign_assets_list: JSON.stringify(add_assets_set),
                unassign_assets_list: JSON.stringify(remove_assets_set)
            },
            error: function(xhr, errmsg, err) {
                console.log(xhr.status + ': ' + xhr.responseText);
            },
            complete: function() {
                window.location.reload(true);
            }
        });
    });

    // Fines
    $(document).on('submit', '#add-fine-form', function(event) {
        event.preventDefault();

        $('#add-fine-submit').replaceWith('<div uk-spinner></div>');

        $.ajax({
            type: 'POST',
            url: "{% url 'users:add_fine' %}",
            data: {
                csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
                student_id: "{{ student.id }}",
                fine_device_id: $('#fine-select-device').val(),
                fine_type_id: $('#fine-select-finetype').val(),
                fine_subtype_id: $('#fine-select-finesubtype').val(),
                fine_note: $('#fine-select-note').val()
            },
            error: function(xhr, errmsg, err) {
                console.log(xhr.status + ': ' + xhr.responseText);
            },
            complete: function() {
                window.location.reload(true);
            }
        });
    });

    // Kevin Bacon Data
    $(document).on("submit", "#update-staging-form", function(event) {
        event.preventDefault();

        var iiq_ticket_number = $("#iiq-ticket-number").val();

        $.ajax({
            type: "POST",
            data: {
                csrfmiddlewaretoken: $("input[name=csrfmiddlewaretoken]").val(),
                action: "update-staging-data",
                device_bin: $("#staging-bin").val(),
                device_bpi: $("#staging-bpi").val(),
                iiq_ticket_number: iiq_ticket_number
            },
            success: function(json) {
                $('#staging-data').prepend(
                    '<div>' +
                        '<div class="uk-alert-success" uk-alert>' +
                            '<a class="uk-alert-close" uk-close></a>' +
                            '<p>The information you entered has been successfully saved.</p>' +
                        '</div>' +
                    '</div>'
                );
            },
            error: function(xhr, errmsg, err) {
                console.log(xhr.status + ": " + xhr.responseText);
                $('#staging-data').prepend(
                    '<div>' +
                        '<div class="uk-alert-danger" uk-alert>' +
                            '<a class="uk-alert-close" uk-close></a>' +
                            '<p>Error! Something went wrong. Please try again or contact the app administrator.</p>' +
                        '</div>' +
                    '</div>'
                );
            }
        });
    });
});
</script>
{% endblock %}
